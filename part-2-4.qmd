# Assessment of naturally-occurring affordable housing {#part-2-4}

```{r setup}

library(tidyverse)
library(simplevis)
library(leaflet)
library(htmlwidgets)
library(ggplot2)
library(janitor)
library(sf)
library(sp)
library(viridis)
library(plotly)
library(scales)
library(zoo)
library(lubridate)

# Utilize the same filters as the Chesterfield County Rental Market Analysis. I've changed the star rating to two or less, which coincides with CoStar's analysis.

# CoStar Filters for Properties: Multi-Family, Localities: Chesterfield, Hanover, Henrico,Richmond City; Construction status: Existing; Stars: 2 or less; Rent type: Market; Max Year Built: 1999; Building class: B, C, and Unclassified

# This returns a total of 479 properties as of 8.17.22

# There are about 80 properties that do not have a listed style. Some may be manufactured home parks. Consider removing property_name == Sedgefield, Holiday Mobile Home Park


# Append data from MHCCV report for manufactured home communities.

pha <- c("51085", "51760", "51087", "51041")

```
## Naturally-occurring affordable housing

Not all affordable housing is supported by public subsidy. In fact, a large share of affordable housing is privately-owned and receives no government assistance. Widely referred to as naturally occurring affordable housing (NOAH), or market-affordable housing, these properties are a growing concern for communities facing housing affordability challenges.

The preservation of NOAH properties has been a growing strategy to support affordable housing in communities as the ability to quickly develop new units has been stifled by labor shortages, rising land prices, and supply chain issues. NOAH is at great risk of being lost because it often requires greater investment to maintain and more likely to be redeveloped---in turn contributing to a loss of affordable housing units.

For analysis purposes, we define NOAH properties as:

* Existing multifamily properties with active leases;
* Classified as Class B, C, or unclassified;
* No public subsidy, rent caps, or other income-based restrictions;
* *CoStar Building Rating* of two or fewer stars out of five;^[Per CoStar, this is rating for the building relative to other buildings of the same type throughout the country.] and
* Built before 2000

Based on this criteria, NOAH properties are located all across the region, especially in the City of Richmond and along the borders of the city and counties, where older multifamily properties exist.

```{r noah-map, fig.cap="Map of NOAH properties in region. Source: CoStar Group, Inc.}

noah <- read_csv("data/pha_noah_81722.csv") |> 
  clean_names() |> 
  st_as_sf(coords = c("longitude", "latitude"), crs=4326, remove=FALSE) |> 
  filter(property_name != "Sedgefield" | property_name != "Holidy Mobile Home Park")

pha_names <- c("Richmond City", "Hanover", "Henrico", "Chesterfield")

geo_colors <- setNames(viridis(4), nm = pha_names)

pal <-colorFactor(palette = c("#440154FF", "#31688EFF","#35B779FF", "#FDE725FF"),
                  levels = c("Richmond City", "Hanover", "Henrico", "Chesterfield"))

# noah_map <- leaflet(noah) |>
#   addProviderTiles(providers$OpenStreetMap.Mapnik) |>
#   addCircleMarkers(
#     radius = 5,
#     color = ~pal(county_name),
#     stroke = TRUE, fillOpacity = 1)
# 
# saveWidget(noah_map, "maps/noah_map.html")

knitr::include_url("maps/noah_map.html")
```

The large share of NOAH is located in the City of Richmond (11,310 units or 45 percent of all NOAH units). This is no doubt due to the large amount of older multifamily properties within city limits --- most of which is located in smaller buildings. Henrico County has the second largest share of NOAH in the region with 8,820 units, followed by Chesterfield County at 3,963 and Hanover County well below 1,000 units.

In total, there are nearly 25,000 NOAH units across 194 properties in the region. This makes up a significant amount of rental inventory, as well as a valuable source of unsubsidized affordable housing. The aging of these properties, as well as the increasing demand for rental housing, puts significant pressure on these properties and their owners. For smaller landlords, the cost to renovate can be far too great --- leading to worsening deferred maintenance and pressure to sell, which both can negatively impact renters.

```{r noah-cnt, fig.cap="NOAH units by locality"}

noah_cnt <- noah |> 
  group_by(county_name) |> 
  summarise(n = sum(number_of_units))

noah_cnt_bar <- ggplot(noah_cnt,
                       aes(x= reorder(county_name, n),
                           y=n,
                           fill=county_name)) +
  geom_bar(stat="identity") +
  coord_flip() +
  labs(title= "NOAH units by locality") +
  theme(axis.title = element_blank(),
        legend.position = "none") +
  scale_fill_manual(values = geo_colors) +
  scale_y_continuous(labels = number_format(big.mark = ","))

ggplotly(noah_cnt_bar) |> 
  plotly_camera()

# Total units is 24,847

```

```{r noah-type, eval=FALSE}


noah_type <- read_csv("data/pha_noah_72822.csv") |> 
  clean_names() |> 
  select(property_address, county_name, property_name, number_of_units, style, year_built) 


```
NOAH properties have not been immune from the rapid rises in rent. As of Q3 2022, the average asking rent for NOAH properties was \$1,173. This is about \$200 less than the average asking rent across all rental properties. Although this seems like a small difference, an extra \$200 a month means more money saved for childcare or transportation costs.

From the beginning of the pandemic to Q3 2022, NOAH rent has increased by \$104 --- a 10 percent increase. 

```{r noah-rents}

# Pulled at end of July; hesitant to re-pull because the data keeps changing on CoStar's side. 

noah_rent <- read_csv("data/pha_noah_rent_81722.csv") |> 
  mutate(period = as.Date(as.yearqtr(period, format = "%Y Q%q"), frac = 1)) |> 
  pivot_longer(cols = 2:3,
               names_to = "type",
               values_to = "rent") |> 
  mutate(type = case_when(
    type == "inf_adj" ~ "Inflation-adjusted",
    type == "rent" ~ "Nominal"
  )) |> 
  mutate(rent = parse_number(rent)) |> 
  filter(between(period, as.Date("2014-03-31"), as.Date("2022-09-30"))) |> 
  mutate(period = as.yearqtr(period))

ggplot(noah_rent,
       aes(x = period, y = rent, color = type)) +
  geom_line(size = 1) +
  scale_y_continuous(labels = label_dollar(),
                     n.breaks = 9) +
  scale_x_yearqtr(format = "%Y Q%q") +
  labs(title = "Average asking rent for market-affordable multifamily",
       subtitle = "2014 Q1 to 2022 Q3 (to-date)",
       color = "Rent value",
       caption = "Source: CoStar Group, Inc.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))


```

```{r noah-sales}

# Search CoStar SALES: 
# NOAH --- Location: Richmond city, Henrico County, Chesterfield County, Hanover County
# Filters: Sale Date: After 8/23/17; CoStar Rating: 2 stars or less; Property type: Multifamily; Construction status: Existing; Rent type: Market; Year built: max 1999; Class: B, C, and unclassified
# ALL SALES --- Location: Richmond city, Henrico County, Chesterfield County, Hanover County
# Filters: Sale Date: After 8/23/17

noah_sales <- read_csv("data/noah_sales_82322.csv") |> 
  clean_names() |> 
  mutate(category = "NOAH")

all_sales <- read_csv("data/all_sales_82322.csv") |> 
  clean_names() |> 
  mutate(category = "All")

mf_sales <- rbind(noah_sales, all_sales) |> 
  subset(period != "Search") |> 
  subset(period != "2017 Q2") |> 
  subset(period != "2017 Q1") |> 
  mutate(period = case_when(
    period == "2022 Q3 QTD" ~ "2022 Q3",
    TRUE ~ period
  )) |> 
  select(period, category, sales = number_of_transactions, avg_sales = average_sale_price, sold_units, average_price_per_unit) |> 
  mutate(period = as.Date(as.yearqtr(period, format = "%Y Q%q"), frac = 1)) |> 
  mutate(average_price_per_unit = parse_number(average_price_per_unit)) |> 
  mutate(sales = parse_number(sales))


```

The sale of NOAH properties and ensuing new ownership often leads to rent increases and/or rehabilitation. In some cases, this may take NOAH properties out of market affordability. Over the last five years, NOAH properties have made up nearly half of all multifamily sales (49 percent).

```{r noah-sales-cnt}
mf_sales_summary <- mf_sales |> 
  group_by(category) |> 
  summarise(sales = sum(sales))

mf_sales_bar <- ggplot(mf_sales,
                        aes(x = period,
                            y = sales,
                            fill = category)) +
  geom_col(position = "identity") +
  theme(axis.title = element_blank()) +
  labs(title = "NOAH versus all multifamily sales", color = "Type")

ggplotly(mf_sales_bar) |> 
  plotly_camera()

```

During this timeframe, NOAH properties had an average price per unit below that of all multifamily sales, but from Q4 2020 to Q1 2021. At the end of 2020, the average price per unit of a NOAH property hit a high of \$221,534 --- over \$44,000 more when compared to all multifamily sales. Although both types of sales took a dip following the end of 2020, the higher NOAH price remained until Q2 2021, when NOAH average price per unit once again went below all sales.

```{r noah-sales-comp}

mf_sales_line <- ggplot(mf_sales,
                        aes(x = period,
                            y = average_price_per_unit,
                            color = category)) +
  geom_line(size = 1) +
  scale_y_continuous(labels = dollar_format()) +
  theme(axis.title = element_blank()) +
  labs(title = "Average price per unit: NOAH versus all multifamily sales", color = "Type")

ggplotly(mf_sales_line) |> 
  plotly_camera()

```

## Manufactured Home Communities

Manufactured home communities (MHCs) are also a valuable source of NOAH across the region. In 2016, the Manufactured Home Community Coalition of Virginia (MHCCV) conducted an assessment of all manufactured home communities across Central Virginia. Their report identified 54 different MHCs, wherein there were at least 2,742 individual manufactured homes. 

This represents both manufactured homes that may be rented, as well as owned, but regardless residents in manufactured home units rent the lot in which their home resides. This leaves many manufactured home community residents who own their homes in a precarious position should a community owner decide to sell or redevelop the property. Manufactured homes are not easily moved once installed, leaving many families forced to abandon their homes and seek new and more expensive housing elsewhere.

```{r mhc-map}

# mhc <- st_read("https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Mobile_Home_Parks/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson")

# pha_mhc <- mhc |>  
#   subset(COUNTYFIPS %in% pha)
# 
# write_rds(pha_mhc, "data/pha_mhc.rds")

# pha_mhc <- read_rds("data/pha_mhc.rds") |> 
#   filter(STATUS != "CLOSED")
# 
# mhc_map <- leaflet(pha_mhc) |> 
#   addTiles() |> 
#   addCircleMarkers(
#     radius = 3
#   )
# 
# saveWidget(mhc_map, "maps/mhc_map.html")

knitr::include_url("map/mhc_map.html")

```

```{r mhc-cnt}

mhccv <- read_csv("data/mhccv_data.csv") |> 
  clean_names()

names <- c("Chesterfield", "Hanover", "Henrico", "Richmond")

mhc_cnt <- mhccv |> 
  group_by(county) |> 
  summarise(units = sum(units)) |> 
  subset(county %in% names)

mhc_bar <- ggplot(mhc_cnt,
                  aes(x = reorder(county, units),
                      y = units, 
                      fill = county)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Manufactured home community units by locality", fill = "Locality") +
  theme(axis.title = element_blank())

ggplotly(mhc_bar) |> 
  plotly_camera()

```

The majority of manufactured home community units are located in Chesterfield County --- largely along the Route 1 corridor. But since the Framework was released several large MHCs in Chesterfield County were purchased by real estate investors --- leading to major concerns about increasing rents and redevelopment. Suburban Village, the county's third largest MHC at 226 units, was purchased by a Maryland-based company in August 2021 for \$22.5 million, while Shady Hill Mobile Home Park (an at least 110 unit community) received an offer of \$7.6 million in Spring 2022.

Manufactured homes --- often located along major corridors --- are well-positioned for redevelopment due to their location and proximity, but they offer many residents in need of housing an option. As these communities continue to be at risk, this puts whole communities in danger of displacement. To head off such negative impacts, affordable housing nonprofit, project:HOMES, acquired a 52 unit manufactured home community called Bermuda Estates in Chesterfield County. Since acquiring the community, project:HOMES has made significant infrastructure improvements, replaced some units in disrepair, and constructed a community center.
