# New Kent County {#part-4-7}

This chapter is a summary of the major changes to the New Kent County's population and housing market in the past five years.

```{r}
#| label: setup

library(tidyverse)
library(tidycensus)
library(sf)
library(sp)
library(plotly)
library(simplevis)
library(tidytext)
library(scales)
library(readxl)
library(zoo)
library(lubridate)
library(janitor)
library(tigris)
library(optiRum)

years <- 2016:2020
fips <- 51127
name <- "New Kent County"
costar_name <- "New Kent County"


```

## Takeaways

```
Add short bullet points summarizing major changes
```

## Demographic and socioeconomic changes

### Population changes

Since 2010, New Kent County's population has been growing slowly --- by a few hundred residents each year. But by 2020, the population experienced a slight decline of 146 residents from 2019's population of 23,091.

```{r}
#| label: fig-pop
#| fig-cap: !expr "paste0(name, /": Total Population/")"

# Add choice of population stat (net change, components, etc)

pop <- read_rds("data/rr_pop_data.rds") |> 
  mutate(GEOID = parse_number(GEOID)) |> 
  filter(counttype != "Forecast",
         GEOID == fips)

pop_bar <- ggplot(pop,
                      aes(x = year,
                          y = value,
                          fill = value)) +
  geom_col() +
  scale_fill_continuous(viridis_pal()) +
  labs(title = paste0(name, ": Total Population"),
       subtitle = "2010 to 2020",
       caption = "Source: U.S. Census Bureau Decennial Census and American Community Survey.") +
  scale_y_continuous(labels = label_comma()) +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

pop_bar

```

New Kent County's population change has been driven largely by domestic migration. Between 2020 and 2021, the population was estimated to have increased by 845 residents due to people moving into the county. 

```{r}
#| label: fig-comp
#| fig-cap: !expr "paste0(name, /": Components of population change/")"

change <- read_rds("data/rr_comp_change.rds") |> 
  filter(year %in% as.character(years) | year == "2021") |> 
  filter(NAMELSAD == name)

ggplot(change,
       aes(x = year,
           y = value,
           fill = component)) +
  geom_col() +
  facet_wrap(~component) +
  labs(title = paste0(name,": Components of population change"), 
       subtitle = "2016 through 2021",
       fill = "Component of change",
       caption = "Note: 2020 components of change data not available.\nSource: U.S. Census Bureau, Population Estimates Program.") +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_y_continuous(labels = label_number(big.mark = ",", style_positive = "plus", style_negative = "minus"))

```

### Household characteristics

The county has seen a decreasing number of renter households across the board. But homeowners continue to come to the county --- especially homeowner households with children. Between 2016 and 2020, there was an estimated 463 more homeowners with children. 

```{r}
#| label: fig-children
#| fig-cap: !expr "paste0(name, /": Change in households with children by tenure/")"

# Add choice of household stat (HHs with children, HHs with seniors, subfamilies, etc)

b25115 <- read_rds("data/b25115_data.rds") |> 
  filter(NAME == name)

ggplot(b25115,
       aes(x = children, y = change, fill = tenure)) +
  geom_col(position = "dodge") + 
  facet_wrap(~children, nrow = 1, scales = "free_x") +
  scale_y_continuous(labels = label_number(style_positive = "plus", big.mark = ",")) +
  labs(title = paste0(name, ": Change in households with children by tenure"),
       subtitle = "2016 to 2020",
       fill = "Tenure",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25115.") +
  theme(axis.title = element_blank(),
        axis.text.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank())

```
The greatest increases in the senior population in the county have been among seniors living with a spouse (+498). In contrast to other localities, New Kent County is not seeing a large increase in seniors living alone --- suggesting that senior families are choosing to stay or move to New Kent County.

```{r}
#| label: fig-seniors
#| fig-cap: !expr "paste0(name, /": Change in senior population by living arrangement/")"

b09020 <- read_rds("data/b09020_data.rds") |> 
  filter(NAME == name) |> 
  mutate(family = str_replace(family, "Group quarters", " "),
         family = fct_relevel(family, "Family", "Nonfamily", " "))

ggplot(b09020,
       aes(y = reorder_within(relationship, change, family),
           x = change,
           fill = relationship)) +
  geom_col(position = "dodge") +
  scale_y_reordered() +
  scale_x_continuous(labels = label_comma()) +
  facet_grid(rows = vars(family), scales = "free_y", space = "free", switch = "y") +
  #scale_y_discrete(labels = function(x) str_wrap(x, width = 10)) +
  labs(title = paste0(name, ": Change in senior population by living arrangement"),
       subtitle="2016 to 2020",
       fill="Tenure",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B09020.") +
  theme(axis.title = element_blank(),
        #axis.text.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.position = "none",
        panel.grid.major.x = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank(),
        strip.placement = "outside",
        strip.text.y = element_text(angle = 0))

```

### Income and wages

Homeowner median household income has been on the incline from 2016 to 2020 --- going from \$92,651 in 2016 to \$104,545 in 2020, a 14 percent increase. Although renter median household income was on its way up from 2016 to 2017, median renter household income has been on decline since a high of \$60,440 in 2017. 

```{r}
#| label: fig-income
#| fig-cap: !expr "paste0(name, /": Median houshold income by tenure/")"

# Add choice of income stat (probably median household income of some kind)

b25119_cpi <-read_rds("data/b25119_cpi.rds") |> 
  filter(NAME == name)

ggplot(b25119_cpi, 
       aes(x = year,
           y = dollars20,
           fill = tenure)) +
  geom_col() +
  facet_wrap(~tenure) +
  scale_y_continuous(labels = dollar_format(), limits = c(0, NA)) +
  labs(title = paste0(name, ": Median houshold income by tenure"), 
       color = "Tenure",
       subtitle = "2016 to 2020 | Adjusted to 2020 dollars",
       caption = "Source: U.S. Census Bureau, American Community Survey") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "none")

# 16 percent increase for renters
# 10 percent increase for homeowners

```

### Persons with disabilities

.....

```{r}
#| label: fig-ind-living
#| fig-cap: !expr "paste0(name, /": Net change in individuals with independent living difficulties by age/")"

# Add disability stat (probably independent living difficulty)

b18107 <- read_rds("data/b18107_data.rds") |> 
  filter(NAME == name) |> 
  group_by(age) |> 
  summarise(change = sum(change))

ggplot(b18107,
       aes(x = age,
           y = change,
           fill = age)) +
  geom_col() +
  labs(title=paste0(name, ": Net change in individuals with\nindependent living difficulties by age"),
       subtitle="2016 to 2020",
       caption="Source: U.S. Census Bureau, American Community Survey, Table B18107.") +
  scale_y_continuous(labels = label_comma()) +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```

## Housing supply and market changes

### Homeownership

New Kent County median home price has been increasing in recent years. From a low of \$294,719 in September 2017 to a high of \$407,231 in May 2022, median home price in the county has increased nearly 40 percent. 

```{r}
#| label: fig-sales
#| fig-cap: !expr "paste0(name, /": Median home sales price/")"

# Median sales price over time

price <- read_csv("data/newkent_med_sales.csv") |> 
  clean_names() |> 
  mutate(geography = name) |> 
  pivot_longer(cols = starts_with("sale"),
    names_to = "label",
    values_to = "med_price",
    values_drop_na = TRUE) |> 
  mutate(year = substr(label, 19,23)) |> 
  select(geography, year, month, med_price)

price$month <- match(price$month, month.abb)

price <- price |> 
  mutate(date = make_date(year, month)) |> 
  mutate(med_price = parse_number(med_price))

cpi <- read_csv("data/CPIAUCSL.csv") |> 
  select(date = DATE, cpi = CPIAUCSL)

price_adj <- price |> 
  left_join(cpi, by = "date") |> 
  mutate(dollars = ((295.271/cpi)*med_price)) |> 
  select(date, med_price, dollars) |> 
  pivot_longer(2:3,
               names_to = "type",
               values_to = "dollars") |> 
  filter(type == "dollars")

ggplot(price_adj,
       aes(x = date,
           y = dollars,
           color = dollars)) +
  geom_line(stat = "identity", size = 1) +
  scale_y_continuous(labels = label_dollar()) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = paste0(name, ": Median home sales price"),
       subtitle = "January 2017 to July 2022",
       caption = "Source: Central Virginia Regional Multiple Listing Service.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_color_continuous(type = "viridis", label = dollar_format()) + 
  geom_smooth(method = "lm")


```

### Rental

CoStar does not list any multifamily properties in New Kent County. However in 2020, there was an estimated 815 renters in the county. This was a decrease from 2016 when there were 1,202 renters (16 percent of total households). Based on U.S. Census Bureau estimates the majority (89 percent) of those 815 renter households in the county live in single-family detached homes.

```{r}
#| label: fig-renters
#| fig-cap: "Renter households in New Kent County"

b25003_vars <- load_variables(2020, "acs5") |> 
  filter(str_sub(name, end = 7) %in% "B25003_")

b25003_raw <- map_dfr(years, function(yr){
   b25003_pull <- get_acs(
    geography = "county",
    state = "VA",
    table = "B25003",
    year = yr,
    survey = "acs5"
  ) |> 
    mutate(year = yr)
})

b25003_vars_cleaned <- b25003_vars |> 
  separate(label, into = c("est", "total", "tenure"), sep = "!!") |> 
  select(variable = name, tenure) |> 
  mutate(tenure = case_when(
    tenure == "Owner occupied" ~ "Homeowner",
    tenure == "Renter occupied" ~ "Renter"
  )) |> 
  drop_na()

b25003_raw <- b25003_raw |> 
  filter(GEOID %in% fips)

b25003_data <- b25003_raw |> 
  right_join(b25003_vars_cleaned, by = "variable") |> 
  select(NAME, GEOID, year, tenure, estimate) |> 
  mutate(NAME = str_remove_all(NAME, ", Virginia")) |>
  group_by(NAME, year) |> 
  mutate(pct = (estimate/sum(estimate))) |> 
  filter(tenure == "Renter")

ggplot(b25003_data,
       aes(x = year,
           y = pct,
           fill = pct)) +
  geom_col() +
  theme(axis.title = element_blank(),
        legend.position = "none") +
  scale_y_continuous(labels = percent_format()) +
  labs(title = "Percent of renter households in New Kent County", 
       fill = "Percent of total households",
       subtitle = "From 2016 to 2020",
       caption = "Source: U.S Census Bureau. American Community Survey 2016-2020 5-Year Estimates. Table B25003.")  + 
  geom_text(aes(label = percent(pct)),
            color = "white",
            vjust = 1)


```

### Housing assistance



## Gap analysis

### Affordability of current housing stock

```{r income-rent-gap, fig.cap=paste0(name, ": Average asking rent versus\nrent affordable to median renter income")}

# Compare local median renter income to average asking rent

b25119_cpi_rent <- b25119_cpi |> 
  filter(tenure == "Renter")

rent <- read_csv("data/rr_annual_rent.csv") |> 
    pivot_longer(cols = 2:8,
               names_to = "locality",
               values_to = "rent_current") |> 
  clean_names() |> 
  filter(locality == costar_name)

rent_gap <- b25119_cpi_rent |> 
  left_join(rent, by = "year") |> 
  mutate(rent_current = parse_number(rent_current)) |> 
  mutate(affordable_rent = (cdollars/12)*.30) |> 
  mutate(difference = rent_current - affordable_rent) |> 
  select(year, rent_current, affordable_rent) |> 
  pivot_longer(2:3,
               names_to = "type",
               values_to = "dollars") |> 
  mutate(type = case_when(
    type == "affordable_rent" ~ "Affordable rent",
    type == "rent_current" ~ "Current rent"
  ))

ggplot(rent_gap,
       aes(x = year,
           y = dollars,
           fill = type)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_y_continuous(labels = label_dollar()) +
  labs(title = paste0(name, ": Average asking rent versus\nrent affordable to median renter income"),
       subtitle = "2016 to 2020",
       fill = "Nominal rent",
       caption = "Sources: U.S. Census Bureau, American Community Survey, Table B25119\nand CoStar Group Inc.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))


```
...

```{r income-own-gap, fig.cap=title = paste0(name, ": Income needed to afford median home price\nversus median renter income")}

# Compare local renter income versus local home prices

rr_sales_annual <- read_csv("data/rr_annual_sales.csv") |> 
  pivot_longer(cols = 2:9,
               names_to = "locality",
               values_to = "price") |> 
  clean_names() |> 
  filter(locality == costar_name)

int_annual <- read_csv("data/fredmac_int_annual.csv")

downpayment <- 0.05 # 5% downpayment
closingcosts <- 0.015 # 1.5% closing costs
utilities <- 250 # Assume $250/month for utilities

sale <- rr_sales_annual |> 
  left_join(b25119_cpi_rent, by = "year") |> 
  left_join(int_annual, by = "year") |> 
  drop_na() |> 
  mutate(principal = price - (price*downpayment)) |> 
  mutate(loanamt = principal/(1-closingcosts)) |> 
  mutate(mortgage = abs(PMT((annual_int/12), 360, loanamt)) + 250) |> 
  mutate(inc_needed = ((mortgage*10)/2.8)*12) |> 
  select(year, inc_needed, cdollars)

slgap <- sale |> 
  pivot_longer(2:3,
               names_to = "data",
               values_to = "value") |> 
  mutate(data = case_when(
    data == "cdollars" ~ "Renter median household income",
    data == "inc_needed" ~ "Income needed to afford median home price"
  ))

ggplot(slgap,
       aes(x = year,
           y = value,
           fill = str_wrap(data, 25))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_y_continuous(labels = label_dollar()) +
  labs(title = paste0(name, ": Income needed to afford median home price\nversus median renter income"),
       subtitle = "2016 to 2020",
       fill = "Nominal income",
       caption = "Sources: U.S. Census Bureau, American Community Survey, Table B25119\nand Central Virginia Regional Multiple Listing Service.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.key.height=unit(1, "cm"))


```
...

```{r gap, fig.cap=paste0(name, ": Rental housing gap by AMI")}

# Add choice of affordability stat (surplus/deficit, income vs prices, etc)

gap <- read_rds("data/tb_18_match.rds") |> 
  filter(county == name) |> 
  group_by(year, household_income, gapcode) |>
  summarise(estimate = sum(estimate)) |>
  mutate(estimate = case_when(
    gapcode == "Gap" ~ estimate * -1,
    gapcode == "Matches or less than income" ~ estimate
  )) |>
  mutate(gapcode = case_when(
    gapcode == "Gap" ~ "Shortage of units",
    gapcode == "Matches or less than income" ~ "Households at or less than income"
  )) |>
  filter(household_income != "80 percent AMI or greater")

ggplot(gap,
       aes(x = year, 
           y = estimate,
           fill = gapcode)) +
  geom_bar(stat = "identity") +
  facet_grid(~household_income) +
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0(name, ": Rental housing gap by AMI"),
       subtitle = "2015 to 2018",
       caption = "Source: U.S. Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "bottom",
        legend.title = element_blank())

```

### Impact of housing costs

...

```{r cb, fig.cap=paste0(name, ": Cumulative change in cost-burdened households by tenure")}

cb <- read_rds("data/cb_7.rds") |> 
  filter(county == name,
         cb_group == "Cost-burdened") |> 
  group_by(year, county, tenure) |> 
  summarise(estimate = sum(estimate)) |> 
  group_by(county, tenure) |> 
  mutate(change = estimate - lag(estimate)) |> 
  drop_na() |> 
  mutate(run_diff = cumsum(change))

ggplot(cb,
       aes(x = year, y = run_diff, fill = tenure)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0(name, ": Cumulative change in cost-burdened households by tenure"),
       subtitle = "2015 to 2018",
       fill = "Tenure",
       caption = "Source: U.S Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```
...
```{r mkv, fig.cap="Enrolled students experiencing homelessness by school year"}

div <- 63

mkv <- read_csv("data/mkv.csv") |> 
  subset(Division %in% div)

ggplot(mkv,
       aes(x = year,
           y = students,
           fill = Name)) +
  geom_bar(stat = "identity") +
  facet_wrap(~Name) +
  labs(title = "Enrolled students experiencing homelessness by school year",
       subtitle = "2016-2017 to 2019-2020",
       caption = "William & Mary School of Education, Project HOME - Virginia.") +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank()) +
  scale_y_continuous(labels = label_comma())

```
