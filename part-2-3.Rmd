# (PART)Housing supply and market changes {.unnumbered}

## Housing assistance {#part-2-3}

```{r setup}

library(tidyverse)
library(tidygeocoder)
library(leaflet)
library(sf)
library(sp)
library(janitor)
library(viridis)
library(htmlwidgets)
library(scales)
library(lubridate)

```

### Assisted income-restricted rental

Federal housing assistance programs such as Low-Income Housing Tax Credits (LIHTC) help low-income residents across the region with rental housing opportunities. In an effort to maximize assistance, these rental subsidy programs are often layered --- meaning that a rental unit may be supported by both LIHTC and project-based Section 8 vouchers. LIHTC accounts for over half (56 percent) of federally assisted rental housing in the region, followed by Section 8 project-based rental assistance (21 percent), which includes various programs found [here](https://preservationdatabase.org/documentation/program-descriptions/).

LIHTC properties have a 30 year commitment to affordability, but only a 15 year compliance period, wherein property owners can increase rents. Nonprofit developers will often seek new allocation of tax credits before their commitment period ends, but there is often little incentive for for-profit developers to maintain affordability restrictions past the compliance period.


```{r nhpd}

# nhpd <- read_csv("data/nhpd_va_subsidies_7_2022.csv") |>
#   clean_names()
# 
# nhpd_clean <- nhpd |>
#   transform(fulladdress = paste(nhpd$street_address, nhpd$city, nhpd$state, nhpd$zip_code, sep= ", ")) |>
#   select(subsidy_name, subsidy_status, subsidy_subname, start_date, end_date, assisted_units, property_name, fulladdress, owner_name, owner_type, target_population, city)
# 
# localities <- c("CHARLES CITY", "CHESTER", "CHESTERFIELD", "GLEN ALLEN", "HENRICO", "HIGHLAND SPRINGS", "MIDLOTHIAN", "NORTH CHESTERFIELD", "Richmond", "RICHMOND", "RICHMOND CITY", "SANDSTON", "ASHLAND", "MECHANICSVILLE")
# 
# nhpd_clean_rr <- nhpd_clean |>
#   subset(city %in% localities)
# 
# nhpd_coded <- nhpd_clean_rr |>
#   geocode(address = fulladdress,
#           method = 'geocodio',
#           full_results = TRUE,
#           unique_only = FALSE,
#           lat = Latitude,
#           long = Longitude)
# 
# nhpd_coded_rr <- nhpd_coded |>
#   mutate(Latitude = case_when(
#     property_name == "NEW MANCHESTER FLATS IX" ~ 37.517602,
#     property_name == "KINGSRIDGE I" ~ 37.551666,
#     property_name == "GRAND OAKS SENIORS" ~ 37.353614,
#     property_name == "IRON BRIDGE ROAD" ~ 37.361812,
#     TRUE ~ Latitude)) |>
#     mutate(Longitude = case_when(
#       property_name == "NEW MANCHESTER FLATS IX" ~ -77.432408,
#       property_name == "KINGSRIDGE I" ~ -77.375593,
#       property_name == "GRAND OAKS SENIORS" ~ -77.457398,
#       property_name == "IRON BRIDGE ROAD" ~ -77.495881,
#       TRUE ~ Longitude))
# 
# write_rds(nhpd_coded_rr, "data/nhpd_rr.csv")

# nhpd_coded_rr <- read_rds("data/nhpd_rr.csv")

# nhpd_coded_rr <- nhpd_coded_rr |>
#   st_as_sf(coords = c("Longitude", "Latitude"), crs=4326, remove = FALSE) |>
#   filter(subsidy_status != "Inactive")|>
#   filter(fulladdress != "PO BOX 8585, RICHMOND, VA, 23226")
# 
# subsidyPal <- colorFactor(viridis(8), nhpd_coded_rr$subsidy_name)
# 
# nhpd_map <- leaflet(nhpd_coded_rr) |>
#   addTiles() |>
#   addCircleMarkers(
#     radius = 5,
#     color = ~subsidyPal(subsidy_name),
#     stroke = FALSE, fillOpacity = 0.5)
# 
# saveWidget(nhpd_map, "maps/nhpd_map.html")
# 
knitr::include_url("maps/nhpd_map.html", height = "500px")

```

```{r subsidy-overall}

nhpd_coded_rr <- read_rds("data/nhpd_rr.csv")

subsidy <- nhpd_coded_rr |> 
  select(subsidy_name, assisted_units, subsidy_status, locality = address_components.county) |> 
  filter(locality != "Charles City County") |> 
  filter(subsidy_status != "Inactive") |> 
  group_by(subsidy_name) |> 
  summarise(units = sum(assisted_units)) |> 
  transform(percent = ave(units, FUN = prop.table))


ggplot(subsidy,
       aes(x = reorder(subsidy_name, units),
           y = percent,
           fill = subsidy_name)) +
  geom_bar(stat = "identity") +
  theme(axis.title = element_blank(),
        axis.ticks.x = element_blank()) +
  labs(title = "Share of federally assisted units by subsidy", fill = "Subsidy name") +
  scale_y_continuous(labels = percent_format()) +
  coord_flip()

```

```{r subsidy-location}

nhpd_coded_rr <- read_rds("data/nhpd_rr.csv")

subsidy_local <- nhpd_coded_rr |> 
  select(subsidy_name, assisted_units, subsidy_status, locality = address_components.county) |> 
  filter(subsidy_status != "Inactive") |> 
  filter(locality != "Charles City County") |> 
  group_by(locality, subsidy_name) |> 
  summarise(units = sum(assisted_units)) |> 
  transform(percent = ave(units, locality, FUN = prop.table))


ggplot(subsidy_local,
       aes(x = reorder(subsidy_name, -units),
           y = units,
           fill = subsidy_name)) +
  geom_bar(stat = "identity") +
  facet_wrap(~locality) +
  theme(axis.title = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  labs(title = "Federally assisted units by subsidy and locality", fill = "Subsidy name") +
  scale_y_continuous(labels = number_format(big.mark = ","))


```
By 2040, a large portion of active LIHTC units will be outside the 30 year commitment period --- even far more will be outside the 15 year compliance period. Just over 13,000 LIHTC units will be beyond the 30 year commitment period by 2040, which accounts for over 80 perceent of active LIHTC units as of early 2022.
```{r lihtc}

nhpd_coded_rr <- read_rds("data/nhpd_rr.csv")

lihtc <- nhpd_coded_rr |> 
  filter(subsidy_name == "LIHTC") |> 
  select(property_name, subsidy_subname, subsidy_status, owner_type, end_date, assisted_units, county = address_components.county) |> 
  mutate(date = mdy(end_date)) |> 
  filter(subsidy_status != "Inactive") |> 
  group_by(date) |> 
  summarise(units = sum(assisted_units))

lihtc_end <- ggplot(lihtc,
                    aes(x = date,
                        y = units)) +
                      geom_col(fill = "dark blue") +
  labs(title = "LIHTC units by 30 year commitment expiration date") +
  theme(axis.title = element_blank()) +
  scale_y_continuous(labels = number_format(big.mark = ","))

ggplotly(lihtc_end) |> 
  plotly_camera()

```
## Public Housing
The redevelopment of public housing in the City of Richmond has begun to take shape at the first of the "Big Six" public housing courts --- Creighton Court. This public housing property located in Richmond's far East End consisted of 503 public housing units. As part of their first phase of redevelopment, Richmond Redevelopment and Housing Authority's (RRHA) has begun demolition of Creighton Court, with plans to develop roughly 700 units of mixed-income housing. Construction on Phase 1 is expected to begin in Winter 2022 with the entire redevelopment process expected to last ten years.

RRHA's next focus area will be Gilpin Court, north of Jackson Ward, where about 780 public housing units reside. In November 2021, RRHA and the City of Richmond were awarded a Choice Neighborhoods Planning Grant by the U.S. Department of Housing and Urban Development for \$450,000. This planning grant is being utilized to facilitate the community planning process around not only Gilpin Court, but the Jackson Ward community --- including strategies to undo the negative impacts of interstate development on the historically Black communities of Jackson Ward and North Jackson Ward.

```{r public-housing}

nhpd_coded_rr <- read_rds("data/nhpd_rr.csv")

ph <- nhpd_coded_rr |> 
  filter(subsidy_name == "Public Housing") 

leaflet(ph) |> 
  addTiles() |> 
  addCircleMarkers(
    radius = ~assisted_units/100
  )


```

## Housing Choice Vouchers

Section 8 Housing Choice Vouchers (HCV) are tenant-based rental assistance that allows recipients to find housing on the open market. This provides household with greater choice in where they want to live, but historically many HCV recipients have faced discrimination from landlords unwilling to accept HCV.

This changed significantly in early 2020, when the Virginia General Assembly passed new fair housing legislation that made it illegal to discriminate based on source of income --- defined as "any source that lawfully provides funds to or on behalf of a renter or buyer of housing, including any assistance, benefit, or subsidy program, whether such program is administered by a governmental or nongovernmental entity.‚Äù

HCV utilization across the region is concentrated in the East End and Southside of Richmond, but can also be found throughout the counties, as well as the Town of Ashland. Higher HCV utilization (above 20 percent) is seen in areas near Fulton Hill, Oakwood, Manchester, and Bellwood in Chesterfield County.


```{r hcv}

# Download HCV geojson from HUD - 7.28.22

# HCV as a Percent of Renter Occupied Housing Units

pha <- c("041", "760", "085", "087")

hcv <- st_read("data/va_hcv_tract.geojson") |> 
  clean_names() |> 
  subset(county %in% pha)

hcv_use <- mapview::mapview(hcv, 
                            zcol= "hcv_public_pct",
                            legend = T,
                            layer.name = "Percent of renter-occupied housing with HCV")

saveWidget(hcv_use@map, "maps/hcv_use.html")

knitr::include_url("maps/hcv_use.html", height = "500px")



```

## Rent relief and mortgage relief

In response to the COVID-19 pandemic's impact on renters across the nation, Congress created a \$25 billion Emergency Rental Assistance (ERA) program that was funded through the CARES Act in 2021. The program was implemented through the U.S. Treasury Department and resulted in a total of $1 billion being allocated to the Commonwealth of Virginia and eligible local governments. 

With this funding, the Virginia Department of Housing and Community Development (DHCD) established the Virginia Rent Relief Program (RRP), while Chesterfield County elected to administer their own rental assistance program through local nonprofit, Area Congregations Together in Service (ACTS). 

Through DHCD, a total of 32,029 payments were made to households across Richmond, Henrico, and Hanover. Both Richmond and Henrico saw increasing households receiving rental assistance with slight dips during the early part of 2022. Few households in Hanover County sought rental relief from DHCD.

[*Awaiting Chesterfield County Data*]

```{r rmrp}

# Email gabriella.vazquez@dhcd.virginia.gov for data on RRP - breakdown of households helped in Hanover, Henrico, and Richmond --- consider including other localities

# Email Jessica about Chesterfield rent relief program.

rrp <- read_csv("data/rrp_data.csv")|> 
  mutate(avgpayment = spent/payments) |> 
  filter(locality == "Hanover County" | locality == "Henrico County" | locality == "Richmond") |> 
  mutate(date = mdy(date))

ggplot(rrp,
       aes(x = date,
           y = payments,
           fill = locality)) +
  geom_bar(stat = "identity") + 
  facet_wrap(~locality) +
  theme(axis.title = element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1)) +
  labs(title = "Rent relief payments by locality") +
  scale_y_continuous(labels = number_format(big.mark = ","))




```
Average payments per household across the three localities was well into the above \$4,000 for most of the program's duration, with the highest payments being made in Hanover County.

```{r rrp-payment}

ggplot(rrp,
       aes(x = date,
           y = avgpayment,
           fill = locality)) +
  geom_bar(stat = "identity") + 
  facet_wrap(~locality) +
  theme(axis.title = element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1)) +
  labs(title = "Average assistance by month and locality") +
  scale_y_continuous(labels = dollar_format())

```
## Affordable homeownership

*Data requested from housing partners*

```{r aff-ho}

# MWCLT, BHC, project:HOMES, Southside, Habitat - WAITING ON DATA

# Ask for number of units produced each year from 2019 to now

# Average home price each year?

```

Changes in assisted housing since 2019
