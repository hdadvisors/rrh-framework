# Powhatan County {#part-4-8}

This chapter is a summary of the major changes to the Powhatan County's population and housing market in the past five years.

```{r setup}

library(tidyverse)
library(tidycensus)
library(sf)
library(sp)
library(plotly)
library(simplevis)
library(tidytext)
library(scales)
library(readxl)
library(zoo)
library(lubridate)
library(janitor)
library(tigris)
library(optiRum)
library(kableExtra)

years <- 2016:2020
fips <- 51145
name <- "Powhatan County"
costar_name <- "Powhatan County"


```

## Takeaways

- 

## Demographic and socioeconomic changes

### Population changes

Despite a dip in population from 2014 to 2015, Powhatan County has been on an upward trend for the most part. In 2020, the county reached a population of 30,333 --- an overall increase of 8 percent since 2010.

```{r}
#| label: fig-pop
#| fig-cap: !expr "paste0(name, /": Total Population/")"

# Add choice of population stat (net change, components, etc)

pop <- read_rds("data/rr_pop_data.rds") |> 
  mutate(GEOID = parse_number(GEOID)) |> 
  filter(counttype != "Forecast",
         GEOID == fips)

pop_bar <- ggplot(pop,
                      aes(x = year,
                          y = value,
                          fill = value)) +
  geom_col() +
  scale_fill_continuous(viridis_pal()) +
  labs(title = paste0(name, ": Total Population"),
       subtitle = "2010 to 2020",
       caption = "Source: U.S. Census Bureau Decennial Census and American Community Survey.") +
  scale_y_continuous(labels = label_comma()) +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

pop_bar

```

Like many other rural counties in the region, Powhatan County's population growth in recent years has been due to domestic migration. Between 2020 and 2021, 772 new residents came to the county from somewhere else within the country. 

```{r}
#| label: fig-comp
#| fig-cap: !expr "paste0(name, /": Components of population change/")"

change <- read_rds("data/rr_comp_change.rds") |> 
  filter(year %in% as.character(years) | year == "2021") |> 
  filter(NAMELSAD == name)

ggplot(change,
       aes(x = year,
           y = value,
           fill = component)) +
  geom_col() +
  facet_wrap(~component) +
  labs(title = paste0(name,": Components of population change"), 
       subtitle = "2016 through 2021",
       fill = "Component of change",
       caption = "Note: 2020 components of change data not available.\nSource: U.S. Census Bureau, Population Estimates Program.") +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_y_continuous(labels = label_number(big.mark = ",", style_positive = "plus", style_negative = "minus"))

```

### Household characteristics

The county has seen a decreasing number of renter households across the board. But homeowners continue to come to the county --- especially homeowner households with no children. By 2020, there was an estimated 590 more homeowners with no children than in 2016.

```{r}
#| label: fig-children
#| fig-cap: !expr "paste0(name, /": Change in households with children by tenure/")"

# Add choice of household stat (HHs with children, HHs with seniors, subfamilies, etc)

b25115 <- read_rds("data/b25115_data.rds") |> 
  filter(NAME == name)

ggplot(b25115,
       aes(x = children, y = change, fill = tenure)) +
  geom_col(position = "dodge") + 
  facet_wrap(~children, nrow = 1, scales = "free_x") +
  scale_y_continuous(labels = label_number(style_positive = "plus", big.mark = ",")) +
  labs(title = paste0(name, ": Change in households with children by tenure"),
       subtitle = "2016 to 2020",
       fill = "Tenure",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25115.") +
  theme(axis.title = element_blank(),
        axis.text.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank())

```
The greatest increases in the senior population in the county have been among seniors in family households (either living with a spouse or are the head of household). In contrast to other localities, Powhatan County is seeing a decline in seniors in nonfamily households.


```{r}
#| label: fig-seniors
#| fig-cap: !expr "paste0(name, /": Change in senior population by living arrangement/")"

b09020 <- read_rds("data/b09020_data.rds") |> 
  filter(NAME == name) |> 
  mutate(family = str_replace(family, "Group quarters", " "),
         family = fct_relevel(family, "Family", "Nonfamily", " "))

ggplot(b09020,
       aes(y = reorder_within(relationship, change, family),
           x = change,
           fill = relationship)) +
  geom_col(position = "dodge") +
  scale_y_reordered() +
  scale_x_continuous(labels = label_comma()) +
  facet_grid(rows = vars(family), scales = "free_y", space = "free", switch = "y") +
  #scale_y_discrete(labels = function(x) str_wrap(x, width = 10)) +
  labs(title = paste0(name, ": Change in senior population by living arrangement"),
       subtitle="2016 to 2020",
       fill="Tenure",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B09020.") +
  theme(axis.title = element_blank(),
        #axis.text.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.position = "none",
        panel.grid.major.x = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank(),
        strip.placement = "outside",
        strip.text.y = element_text(angle = 0))

```

### Income and wages

Both homeowner and renter median household income has been on the incline from 2016 to 2020 in the county. For homeowners, there has been an increase of 8 percent, while renters experienced a 20 percent increase.

```{r}
#| label: fig-income
#| fig-cap: !expr "paste0(name, /": Median houshold income by tenure/")"

# Add choice of income stat (probably median household income of some kind)

b25119_cpi <-read_rds("data/b25119_cpi.rds") |> 
  filter(NAME == name)

ggplot(b25119_cpi, 
       aes(x = year,
           y = dollars20,
           fill = tenure)) +
  geom_col() +
  facet_wrap(~tenure) +
  scale_y_continuous(labels = dollar_format(), limits = c(0, NA)) +
  labs(title = paste0(name, ": Median houshold income by tenure"), 
       color = "Tenure",
       subtitle = "2016 to 2020 | Adjusted to 2020 dollars",
       caption = "Source: U.S. Census Bureau, American Community Survey") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "none")

# 16 percent increase for renters
# 10 percent increase for homeowners

```

### Persons with disabilities

In the county, there has been an increase in individuals with independent living difficulties that are 65 years old and older (+204) between 2016 and 2020. For individuals younger than 65, there has been a decline in individuals with independent living difficulties.

```{r}
#| label: fig-ind-living
#| fig-cap: !expr "paste0(name, /": Net change in individuals with independent living difficulties by age/")"

# Add disability stat (probably independent living difficulty)

b18107 <- read_rds("data/b18107_data.rds") |> 
  filter(NAME == name) |> 
  group_by(age) |> 
  summarise(change = sum(change))

ggplot(b18107,
       aes(x = age,
           y = change,
           fill = age)) +
  geom_col() +
  labs(title=paste0(name, ": Net change in individuals with\nindependent living difficulties by age"),
       subtitle="2016 to 2020",
       caption="Source: U.S. Census Bureau, American Community Survey, Table B18107.") +
  scale_y_continuous(labels = label_comma()) +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```



## Housing supply and market changes

### Homeownership

Powhatan County median home price has been on the rise. From a low of \$282,084 in March 2017 to a high of \$519,559 in May 2022, median home price in the county has increased nearly 84 percent. Although the over \$500,000 median home price may represent a seasonal spike, median home price has generally been trending upward and likely to stay above \$500,000 in the coming years.

```{r}
#| label: fig-sales
#| fig-cap: !expr "paste0(name, /": Median home sales price/")"

# Median sales price over time

price <- read_csv("data/powhatan_med_sales.csv") |> 
  clean_names() |> 
  mutate(geography = name) |> 
  pivot_longer(cols = starts_with("sale"),
    names_to = "label",
    values_to = "med_price",
    values_drop_na = TRUE) |> 
  mutate(year = substr(label, 19,23)) |> 
  select(geography, year, month, med_price)

price$month <- match(price$month, month.abb)

price <- price |> 
  mutate(date = make_date(year, month)) |> 
  mutate(med_price = parse_number(med_price))

cpi <- read_csv("data/CPIAUCSL.csv") |> 
  select(date = DATE, cpi = CPIAUCSL)

price_adj <- price |> 
  left_join(cpi, by = "date") |> 
  mutate(dollars = ((295.271/cpi)*med_price)) |> 
  select(date, med_price, dollars) |> 
  pivot_longer(2:3,
               names_to = "type",
               values_to = "dollars") |> 
  filter(type == "dollars")

ggplot(price_adj,
       aes(x = date,
           y = dollars,
           color = dollars)) +
  geom_line(stat = "identity", size = 1) +
  scale_y_continuous(labels = label_dollar()) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = paste0(name, ": Median home sales price"),
       subtitle = "January 2017 to July 2022",
       caption = "Source: Central Virginia Regional Multiple Listing Service.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_color_continuous(type = "viridis", label = dollar_format()) + 
  geom_smooth(method = "lm")


```

### Rental

CoStar lists three multifamily properties in the county; two are located along Old Buckingham Road near the county seat, while the third is located at the eastern edge of the county near Midlothian. There was a 39 year period between the construction of both Powhatan Apartment buildings and the Artistry. 

The development of the Artistry at Winterfield represents growing housing demand from the western edge of Chesterfield County's Midlothian community. This luxury multifamily property also includes 


```{r}
#| label: tbl-mf-list
#| tbl-cap: "Powhatan County: Multifamily properties"

names <- c("Artistry at Winterfield", "Powhatan Apartments", "Powhatan Apartments")
units <- c(200, 11, 11)
rating <- c(4, 2, 3)
year <- c(2021, 1982, 1982)

mf_tbl <- data.frame(names, year, rating, units)

mf_tbl |> kable(caption = "Multifamily properties in Powhatan County",
        col.names = c("Property name", "Year built", "CoStar rating", "Units")) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "striped", "hover"))


```

```{r}
#| label: fig-renters
#| fig-cap: "Renter households in New Kent County"

b25003_vars <- load_variables(2020, "acs5") |> 
  filter(str_sub(name, end = 7) %in% "B25003_")

b25003_raw <- map_dfr(years, function(yr){
   b25003_pull <- get_acs(
    geography = "county",
    state = "VA",
    table = "B25003",
    year = yr,
    survey = "acs5"
  ) |> 
    mutate(year = yr)
})

b25003_vars_cleaned <- b25003_vars |> 
  separate(label, into = c("est", "total", "tenure"), sep = "!!") |> 
  select(variable = name, tenure) |> 
  mutate(tenure = case_when(
    tenure == "Owner occupied" ~ "Homeowner",
    tenure == "Renter occupied" ~ "Renter"
  )) |> 
  drop_na()

b25003_raw <- b25003_raw |> 
  filter(GEOID %in% fips)

b25003_data <- b25003_raw |> 
  right_join(b25003_vars_cleaned, by = "variable") |> 
  select(NAME, GEOID, year, tenure, estimate) |> 
  mutate(NAME = str_remove_all(NAME, ", Virginia")) |>
  group_by(NAME, year) |> 
  mutate(pct = (estimate/sum(estimate))) |> 
  filter(tenure == "Renter")

ggplot(b25003_data,
       aes(x = year,
           y = pct,
           fill = pct)) +
  geom_col() +
  theme(axis.title = element_blank(),
        legend.position = "none") +
  scale_y_continuous(labels = percent_format()) +
  labs(title = "Percent of renter households in Powhatan County", 
       fill = "Percent of total households",
       subtitle = "From 2016 to 2020",
       caption = "Source: U.S Census Bureau. American Community Survey 2016-2020 5-Year Estimates. Table B25003.")  + 
  geom_text(aes(label = percent(pct)),
            color = "white",
            vjust = 1)


```

### Housing assistance

The National Housing Preservation Database lists no federally-assisted housing properties in New Kent County. 

### Naturally-occurring affordable housing

CoStar does not list any properties that can be defined as naturally-occurring affordable housing within New Kent County. However, there are at least three manufactured home communities located in the county. These communities represent a small but important source of affordability in the county.

Putze's Mobile Home Park located in Quinton is an 11 unit community and Long Acres Mobile Home Park is a 24 unit community located in Providence Forge.

Rockahock Park is a combination manufactured home community and RV campground with an indeterminate amount of lots. 

```{r}
#| label: fig-mhc
#| fig-cap: !expr "paste0(name, /": Manufactured home communities/")"

mhc <- st_read("https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Mobile_Home_Parks/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson") |> 
  filter(STATE == "VA",
         COUNTY == "POWHATAN")

library(leaflet)

leaflet(mhc) |> 
  addTiles() |> 
  addCircleMarkers()

```

## Gap analysis

### Affordability of current housing stock

A lack of diverse rental options leave lower income households with few housing options in the county aside from renting a single-family home. To purchase a single-family home, the typical renter in the county would need to make at least \$17,000 more than they did in 2020. 

```{r}
#| label: fig-income-own-gap
#| fig-cap: !expr "paste0(name, /": Income needed to afford median home price\nversus median renter income/")"

# Compare local renter income versus local home prices

rr_sales_annual <- read_csv("data/rr_annual_sales.csv") |> 
  pivot_longer(cols = 2:9,
               names_to = "locality",
               values_to = "price") |> 
  clean_names() |> 
  filter(locality == costar_name)

int_annual <- read_csv("data/fredmac_int_annual.csv")

downpayment <- 0.05 # 5% downpayment
closingcosts <- 0.015 # 1.5% closing costs
utilities <- 250 # Assume $250/month for utilities

sale <- rr_sales_annual |> 
  left_join(b25119_cpi_rent, by = "year") |> 
  left_join(int_annual, by = "year") |> 
  drop_na() |> 
  mutate(principal = price - (price*downpayment)) |> 
  mutate(loanamt = principal/(1-closingcosts)) |> 
  mutate(mortgage = abs(PMT((annual_int/12), 360, loanamt)) + 250) |> 
  mutate(inc_needed = ((mortgage*10)/2.8)*12) |> 
  select(year, inc_needed, cdollars)

slgap <- sale |> 
  pivot_longer(2:3,
               names_to = "data",
               values_to = "value") |> 
  mutate(data = case_when(
    data == "cdollars" ~ "Renter median household income",
    data == "inc_needed" ~ "Income needed to afford median home price"
  ))

ggplot(slgap,
       aes(x = year,
           y = value,
           fill = str_wrap(data, 25))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_y_continuous(labels = label_dollar()) +
  labs(title = paste0(name, ": Income needed to afford median home price\nversus median renter income"),
       subtitle = "2016 to 2020",
       fill = "Nominal income",
       caption = "Sources: U.S. Census Bureau, American Community Survey, Table B25119\nand Central Virginia Regional Multiple Listing Service.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.key.height=unit(1, "cm"))


```

In spite of a low number of rental housing options in the county, there was still a shortage of 255 rental housing units for households making 80 percent AMI or less in 2018. This shortage is an increase from 2015 when the shortage was 135. The increase in deficit was most significant for households making between 51 and 80 percent AMI --- an increase of 75 households from zero.

```{r}
#| label: fig-gap
#| fig-cap: !expr "paste0(name, /": Rental housing gap by AMI/")"

# Add choice of affordability stat (surplus/deficit, income vs prices, etc)

gap <- read_rds("data/tb_18_match.rds") |> 
  filter(county == name) |> 
  group_by(year, household_income, gapcode) |>
  summarise(estimate = sum(estimate)) |>
  mutate(estimate = case_when(
    gapcode == "Gap" ~ estimate * -1,
    gapcode == "Matches or less than income" ~ estimate
  )) |>
  mutate(gapcode = case_when(
    gapcode == "Gap" ~ "Shortage of units",
    gapcode == "Matches or less than income" ~ "Households at or less than income"
  )) |>
  filter(household_income != "80 percent AMI or greater")

ggplot(gap,
       aes(x = year, 
           y = estimate,
           fill = gapcode)) +
  geom_bar(stat = "identity") +
  facet_grid(~household_income) +
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0(name, ": Rental housing gap by AMI"),
       subtitle = "2015 to 2018",
       caption = "Source: U.S. Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "bottom",
        legend.title = element_blank())

```

### Impact of housing costs

Although the number of renter households in the county has been declining, the share of cost-burdened renters has only increased. In 2018, 34 percent of renter households were cost-burdened compared to about 26 percent in 2015. For homeowners, the number of cost-burdened households has remained largely unchanged (1352 in 2015 and 1322 in 2018). But as new homeowners come into the county, the share of cost-burdened homeowners has declined from 22 to 20 percent. 

```{r}
#| label: fig-cb
#| fig-cap: !expr "paste0(name, /": Cost-burdened households by tenure/")"

cb <- read_rds("data/cb_7.rds") |> 
  filter(county == name) |> 
  group_by(year, tenure, cb_group) |> 
  summarise(estimate = sum(estimate)) |> 
  mutate(pct = estimate/sum(estimate))

ggplot(cb,
       aes(x = year, y = pct, fill = cb_group)) +
  facet_wrap(~tenure) +
  geom_col(position = position_fill(reverse = TRUE)) +
  scale_y_continuous(labels = percent_format()) +
  labs(title = paste0(name, ": Cumulative change in cost-burdened households by tenure"),
       subtitle = "2015 to 2018",
       fill = "Cost burden",
       caption = "Source: U.S Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```

Available data from William and Mary's Project HOPE shows that the number of enrolled students experiencing homelessness in the county has declined in recent years. The county's McKinney-Vento Act data showed that there were 37 students experiencing homeless in the 2017-2017 school year. By the 2019-2020, that number had declined to 26. 
```{r}
#| label: fig-mkv
#| fig-cap: !expr "paste0(name, /"Enrolled students experiencing homelessness by school year/")"

div <- 72

mkv <- read_csv("data/mkv.csv") |> 
  subset(Division %in% div)

ggplot(mkv,
       aes(x = year,
           y = students,
           fill = Name)) +
  geom_bar(stat = "identity") +
  facet_wrap(~Name) +
  labs(title = "Enrolled students experiencing homelessness by school year",
       subtitle = "2016-2017 to 2019-2020",
       caption = "William & Mary School of Education, Project HOME - Virginia.") +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank()) +
  scale_y_continuous(labels = label_comma())

```
