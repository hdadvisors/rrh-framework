# New Kent County {#part-4-8}

This chapter is a summary of the major changes to the New Kent County's population and housing market in the past five years.

```{r}
#| label: setup

library(tidyverse)
library(tidycensus)
library(sf)
library(sp)
library(plotly)
library(simplevis)
library(tidytext)
library(scales)
library(readxl)
library(zoo)
library(lubridate)
library(janitor)
library(tigris)
library(FinCal)
library(hdatools)
library(ggiraph)
library(ggtext)

years <- 2016:2020
fips <- 51127
name <- "New Kent County"
costar_name <- "New Kent County"


```

## Takeaways

- The county has grown by 24 percent since 2010 --- reaching a population of 22,945 as of 2020.
- Much of the population growth in recent years has been a result of domestic migration.
- Renters are exiting the county, while more and more new homeowners are setting up permanent residence in the county --- especially homeowners with children (+463 households between 2016 and 2020).
- If home sales trends continue, median home price in the county is well on its way to $400,000.
- Few rental options in the county leave lower income households having to rent single-family detached homes or simply leave the county.
- Those renters that remain in the county are seeing increasing cost burden.

## Demographic and socioeconomic changes

### Population changes

Since 2010, New Kent County's population has been growing slowly --- by a few hundred residents each year. But by 2020, the population experienced a slight decline of 146 residents from 2019's population of 23,091.

```{r}
#| label: fig-pop
#| fig-cap: !expr "paste0(name, \": Total Population\")"

# Add choice of population stat (net change, components, etc)

pop <- read_rds("data/rr_pop_data.rds") |> 
  mutate(GEOID = parse_number(GEOID)) |> 
  filter(counttype != "Forecast",
         GEOID == fips)

pop_bar <- ggplot(pop,
                  aes(x = year,
                      y = value,
                      fill = value,
                      data_id = value,
                      tooltip = label_comma()(value))) +
                    geom_col() + 
  theme_pha() +
  geom_col_interactive(size = 2) +
  scale_fill_gradientn(colours = c("#CAE3C2", "#74BA91", "#519B8D", "#2B4258")) + 
  labs(title = paste0(name, ": Total Population"),
                         subtitle = "2010 to 2020",
                         caption = "**Source:** U.S. Census Bureau Decennial Census and American Community Survey.") +
  scale_y_continuous(labels = label_comma()) 

if (knitr::is_html_output()) {
  
  girafe(ggobj = pop_bar,
         height_svg = 4)
} else {
  
  pop_bar
}

```

New Kent County's population change has been driven largely by domestic migration. Between 2020 and 2021, the population was estimated to have increased by 845 residents due to people moving into the county. 

```{r}
#| label: fig-comp
#| fig-cap: !expr "paste0(name, \": Components of population change\")"

change <- read_rds("data/rr_comp_change.rds") |> 
  filter(year %in% as.character(years) | year == "2021") |> 
  filter(NAMELSAD == name)

pop_change <- ggplot(change,
       aes(x = year,
           y = value,
           fill = component,
           data_id = value, 
           tooltip = value)) +
  geom_col() +
  geom_col_interactive(size = 2) + 
  facet_wrap(~component) + 
  theme_pha() +
  scale_fill_pha() +
  labs(title = paste0(name,": Components of population change"), 
       subtitle = "2016 through 2021",
       fill = "Component of change",
       caption = "**Note:** 2020 components of change data not available.\n**Source:** U.S. Census Bureau, Population Estimates Program.") +
  scale_y_continuous(labels = label_number(big.mark = ",", style_positive = "plus", style_negative = "minus"))


if (knitr::is_html_output()) {
  
  girafe(ggobj = pop_change,
         height_svg = 4)
  
} else {
  
  pop_change
  
  }


```

### Household characteristics

The county has seen a decreasing number of renter households across the board. But homeowners continue to come to the county --- especially homeowner households with children. Between 2016 and 2020, there was an increase of 463 homeowners with children.

```{r}
#| label: fig-children
#| fig-cap: !expr "paste0(name, \": Change in households with children by tenure\")"

# Add choice of household stat (HHs with children, HHs with seniors, subfamilies, etc)

b25115 <- read_rds("data/b25115_data.rds") |> 
  filter(NAME == name)

ch_plot <- ggplot(b25115,
       aes(x = children, 
           y = change, 
           fill = tenure)) +
  geom_col(position = "dodge") + 
  theme_pha() +
  scale_fill_pha() +
  facet_wrap(~children, nrow = 1, scales = "free_x") +
  geom_col_interactive(position = "dodge", size = 2) +
  scale_y_continuous(labels = label_number(style_positive = "plus", big.mark = ",")) +
  labs(title = paste0(name, ": Change in households with children by tenure"),
       subtitle = "2016 to 2020",
       fill = "Tenure",
       caption = "**Source:** U.S. Census Bureau, American Community Survey, Table B25115.")


if (knitr::is_html_output()) {
  
  girafe(ggobj = ch_plot,
         height_svg = 4)
  
} else {
  
  ch_plot
  
  }

```
The greatest increases in the senior population in the county have been among seniors living with a spouse (+498). In contrast to other localities, New Kent County is not seeing a large increase in seniors living alone --- suggesting that senior families are choosing to stay or move to New Kent County.

```{r}
#| label: fig-seniors
#| fig-cap: !expr "paste0(name, \": Change in senior population by living arrangement\")"

b09020 <- read_rds("data/b09020_data.rds") |> 
  filter(NAME == name) |> 
  mutate(family = str_replace(family, "Group quarters", " "),
         family = fct_relevel(family, "Family", "Nonfamily", " "))

snr_plot <- ggplot(b09020,
       aes(y = reorder_within(relationship, change, family),
           x = change,
           fill = family,
           data_id = change,
           tooltip = change)) +
  geom_col(position = "dodge") +
  geom_col_interactive(position = "dodge", size = 2) +
  theme_pha() +
  scale_fill_pha() +
  scale_y_reordered() +
  scale_x_continuous(labels = label_comma()) +
  facet_grid(rows = vars(family), scales = "free_y", space = "free", switch = "y") +
  #scale_y_discrete(labels = function(x) str_wrap(x, width = 10)) +
  labs(title = paste0(name, ": Change in senior population by living arrangement"),
       subtitle="2016 to 2020",
       fill="Tenure",
       caption = "**Source:** U.S. Census Bureau, American Community Survey, Table B09020.") +
  theme(strip.placement = "outside",
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_line(color = "#e2e4e3",
                                          size = 0.05))

if (knitr::is_html_output()) {
  
  girafe(ggobj = snr_plot,
         height_svg = 4)
  
} else {
  
  snr_plot
  
  }

```

### Income and wages

Homeowner median household income has been on the incline from 2016 to 2020 --- going from \$92,651 in 2016 to \$104,545 in 2020, a 14 percent increase. Although renter median household income was on its way up from 2016 to 2017, median renter household income has been on decline since a high of \$60,440 in 2017. 

```{r}
#| label: fig-income
#| fig-cap: !expr "paste0(name, \": Median houshold income by tenure\")"

# Add choice of income stat (probably median household income of some kind)

b25119_cpi <-read_rds("data/b25119_cpi.rds") |> 
  filter(NAME == name)

inc_plot <- ggplot(b25119_cpi, 
       aes(x = year,
           y = dollars20,
           fill = tenure,
           data_id = dollars20,
           tooltip = dollar_format()(dollars20))) +
  geom_col() +
  geom_col_interactive(size =2) +
  theme_pha() +
  scale_fill_pha() +
  facet_wrap(~tenure) +
  scale_y_continuous(labels = dollar_format(), limits = c(0, NA)) +
  labs(title = paste0(name, ": Median houshold income by tenure"), 
       color = "Tenure",
       subtitle = "2016 to 2020 | Adjusted to 2020 dollars",
       caption = "Source: U.S. Census Bureau, American Community Survey")


if (knitr::is_html_output()) {
  
  girafe(ggobj = inc_plot,
         height_svg = 4)
  
} else {
  
  inc_plot
  
  }


```

### Persons with disabilities

.....

```{r}
#| label: fig-ind-living
#| fig-cap: !expr "paste0(name, \": Net change in individuals with independent living difficulties by age\")"

# Add disability stat (probably independent living difficulty)

b18107 <- read_rds("data/b18107_data.rds") |> 
  filter(NAME == name) |> 
  group_by(age) |> 
  summarise(change = sum(change))

ind_plot <- ggplot(b18107,
       aes(x = age,
           y = change,
           fill = age,
           data_id = change,
           tooltip = change)) +
  geom_col() +
  geom_col_interactive(size = 2) +
  theme_pha() +
  scale_fill_pha() + 
  labs(title = paste0(name, ": Net change in individuals with\nindependent living difficulties by age"),
       subtitle = "2016 to 2020",
       caption = "**Source:** U.S. Census Bureau, American Community Survey, Table B18107.") +
  scale_y_continuous(labels = label_comma()) 


if (knitr::is_html_output()) {
  
  girafe(ggobj = ind_plot,
         height_svg = 4)
  
} else {
  
  ind_plot
  
  }

```

## Housing supply and market changes

### Homeownership

New Kent County median home price has been increasing in recent years. From a low of \$296,207 in September 2017 to a high of \$409,286 in May 2022, median home price in the county has increased nearly 40 percent. 

```{r}
#| label: fig-sales
#| fig-cap: !expr "paste0(name, \": Median home sales price\")"

# Median sales price over time

price <- read_csv("data/newkent_med_sales.csv") |> 
  clean_names() |> 
  mutate(geography = name) |> 
  pivot_longer(cols = starts_with("sale"),
    names_to = "label",
    values_to = "med_price",
    values_drop_na = TRUE) |> 
  mutate(year = substr(label, 19,23)) |> 
  select(geography, year, month, med_price)

price$month <- match(price$month, month.abb)

price <- price |> 
  mutate(date = make_date(year, month)) |> 
  mutate(med_price = parse_number(med_price))

cpi <- read_csv("data/CPIAUCSL.csv") |> 
  select(date = DATE, cpi = CPIAUCSL)

price_adj <- price |> 
  left_join(cpi, by = "date") |> 
  mutate(dollars = ((296.761/cpi)*med_price)) |> 
  select(date, med_price, dollars) |> 
  pivot_longer(2:3,
               names_to = "type",
               values_to = "dollars") |> 
  filter(type == "dollars")

sales_plot <- ggplot(price_adj,
       aes(x = date,
           y = dollars,
           color = dollars,
           color = dollars,
           group = 1)) +
  geom_line(size = 1) +
  geom_point_interactive(
    aes(data_id = dollars,
        tooltip = label_dollar()(dollars)),
    size = 0.5) + 
  theme_pha() +
  scale_color_gradientn(colours = c("#CAE3C2", "#74BA91", "#519B8D", "#2B4258")) +
  scale_y_continuous(labels = label_dollar()) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = paste0(name, ": Median home sales price"),
       subtitle = "January 2017 to September 2022",
       caption = "**Source:** Central Virginia Regional Multiple Listing Service.") +
  geom_smooth(method = "lm", color = "#Be451c")

if (knitr::is_html_output()) {
  
  girafe(ggobj = sales_plot,
         height_svg = 4)
  
} else {
  
  sales_plot
  
  }


```

### Rental

CoStar does not list any multifamily properties in New Kent County. However in 2020, there was an estimated 815 renters in the county. This was a decrease from 2016 when there were 1,202 renters (16 percent of total households). Based on U.S. Census Bureau estimates the majority (89 percent) of those 815 renter households in the county live in single-family detached homes.

```{r}
#| label: fig-renters
#| fig-cap: "Renter households in New Kent County"

b25003_vars <- load_variables(2020, "acs5") |> 
  filter(str_sub(name, end = 7) %in% "B25003_")

b25003_raw <- map_dfr(years, function(yr){
   b25003_pull <- get_acs(
    geography = "county",
    state = "VA",
    table = "B25003",
    year = yr,
    survey = "acs5"
  ) |> 
    mutate(year = yr)
})

b25003_vars_cleaned <- b25003_vars |> 
  separate(label, into = c("est", "total", "tenure"), sep = "!!") |> 
  select(variable = name, tenure) |> 
  mutate(tenure = case_when(
    tenure == "Owner occupied" ~ "Homeowner",
    tenure == "Renter occupied" ~ "Renter"
  )) |> 
  drop_na()

b25003_raw <- b25003_raw |> 
  filter(GEOID %in% fips)

renter_plot <- b25003_data <- b25003_raw |> 
  right_join(b25003_vars_cleaned, by = "variable") |> 
  select(NAME, GEOID, year, tenure, estimate) |> 
  mutate(NAME = str_remove_all(NAME, ", Virginia")) |>
  group_by(NAME, year) |> 
  mutate(pct = (estimate/sum(estimate))) |> 
  filter(tenure == "Renter")

ggplot(b25003_data,
       aes(x = year,
           y = pct,
           fill = pct,
           data_id = pct,
           tooltip = label_percent()(pct))) + 
  geom_col() +
  geom_col_interactive(size = 2) +
  theme_pha() +
  scale_fill_gradientn(colours = c("#CAE3C2", "#74BA91", "#519B8D", "#2B4258")) +
  scale_y_continuous(labels = percent_format()) +
  labs(title = "Percent of renter households in New Kent County", 
       fill = "Percent of total households",
       subtitle = "From 2016 to 2020",
       caption = "Source: U.S Census Bureau. American Community Survey 2016-2020 5-Year Estimates. Table B25003.")

if (knitr::is_html_output()) {
  
  girafe(ggobj = renter_plot,
         height_svg = 4)
  
} else {
  
  renter_plot
  
  }


```

### Housing assistance

The National Housing Preservation Database lists no federally-assisted housing properties in New Kent County. 

### Naturally-occurring affordable housing

CoStar does not list any properties that can be defined as naturally-occurring affordable housing within New Kent County. However, there are at least three manufactured home communities located in the county. These communities represent a small but important source of affordability in the county.

Putze's Mobile Home Park located in Quinton is an 11 unit community and Long Acres Mobile Home Park is a 24 unit community located in Providence Forge.

Rockahock Park is a combination manufactured home community and RV campground with an indeterminate amount of lots. 

```{r}
#| label: fig-mhc
#| fig-cap: !expr "paste0(name, \": Manufactured home communities\")"

mhc <- st_read("https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Mobile_Home_Parks/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", quiet = TRUE) |> 
  filter(STATE == "VA",
         COUNTY == "NEW KENT")

library(leaflet)

leaflet(mhc) |> 
  addTiles() |> 
  addCircleMarkers()

```

## Gap analysis

### Affordability of current housing stock

A lack of diverse rental options leave lower income households with few housing options in the county aside from renting a single-family home. To purchase a single-family home, the typical renter in the county would need to make at least \$17,000 more than they did in 2020. 

```{r}
#| label: fig-income-own-gap
#| fig-cap: !expr "paste0(name, \": Income needed to afford median home price\nversus median renter income\")"

# Compare local renter income versus local home prices

rr_sales_annual <- read_csv("data/rr_annual_sales.csv") |> 
  pivot_longer(cols = 2:9,
               names_to = "locality",
               values_to = "price") |> 
  clean_names() |> 
  filter(locality == costar_name)

int_annual <- read_csv("data/fredmac_int_annual.csv")

downpayment <- 0.05 # 5% downpayment
closingcosts <- 0.015 # 1.5% closing costs
utilities <- 250 # Assume $250/month for utilities

b25119_cpi <- b25119_cpi |> 
  filter(tenure == "Renter")

sale <- rr_sales_annual |> 
  left_join(b25119_cpi, by = "year") |> 
  left_join(int_annual, by = "year") |> 
  drop_na() |> 
  mutate(principal = price - (price*downpayment)) |> 
  mutate(loanamt = principal/(1-closingcosts)) |> 
  mutate(mortgage = abs(pmt((annual_int/12), 360, loanamt, 0)) + 250) |> 
  mutate(inc_needed = ((mortgage*10)/2.8)*12) |> 
  select(year, inc_needed, cdollars)

slgap <- sale |> 
  pivot_longer(2:3,
               names_to = "data",
               values_to = "value") |> 
  mutate(data = case_when(
    data == "cdollars" ~ "Renter median household income",
    data == "inc_needed" ~ "Income needed to afford median home price"
  ))

slgap_plot <- ggplot(slgap,
       aes(x = year,
           y = value,
           fill = str_wrap(data, 25),
           data_id = value,
           tooltip = dollar_format()(value))) +
  geom_col(position = "dodge") +
  geom_col_interactive(position = "dodge", size = 2) +
  scale_y_continuous(labels = label_dollar()) + 
  theme_pha() +
  scale_fill_pha() +
  labs(title = paste0(name, ": Income needed to afford median home price\nversus median renter income"),
       subtitle = "2016 to 2020",
       fill = "Nominal income",
       caption = "Sources: U.S. Census Bureau, American Community Survey, Table B25119\nand Central Virginia Regional Multiple Listing Service.") +
  theme(legend.position = "top")

if (knitr::is_html_output()) {
  
  girafe(ggobj = slgap_plot,
         height_svg = 4) 
  
} else {
  
  slgap_plot
  
  }

```

In spite of a low number of rental housing options in the county, there was still a shortage of 255 rental housing units for households making 80 percent AMI or less in 2018. This shortage is an increase from 2015 when the shortage was 135. The increase in deficit was most significant for households making between 51 and 80 percent AMI --- an increase of 75 households from zero.

```{r}
#| label: fig-gap
#| fig-cap: !expr "paste0(name, \": Rental housing gap by AMI\")"

# Add choice of affordability stat (surplus/deficit, income vs prices, etc)

gap <- read_rds("data/tb_18_match.rds") |> 
  filter(county == name) |> 
  group_by(year, household_income, gapcode) |>
  summarise(estimate = sum(estimate)) |>
  mutate(estimate = case_when(
    gapcode == "Gap" ~ estimate * -1,
    gapcode == "Matches or less than income" ~ estimate
  )) |>
  mutate(gapcode = case_when(
    gapcode == "Gap" ~ "Shortage of units",
    gapcode == "Matches or less than income" ~ "Households at or less than income"
  )) |>
  filter(household_income != "80 percent AMI or greater")

gap_plot <- ggplot(gap,
       aes(x = year, 
           y = estimate,
           fill = gapcode,
           data_id = estimate,
           tooltip = estimate)) +
  geom_col() + 
  geom_col_interactive(size = 2) + 
  facet_grid(~household_income) + 
  theme_pha() +
  scale_fill_pha() + 
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0(name, ": Rental housing gap by AMI"),
       subtitle = "2015 to 2018",
       caption = "**Source:** U.S. Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(legend.position = "top")

if (knitr::is_html_output()) {
  
  girafe(ggobj = gap_plot,
         height_svg = 4) 
  
} else {
  
  gap_plot
  
  }

```

### Impact of housing costs

Although the number of renter households in the county has been declining, the share of cost-burdened renters has only increased. In 2019, 41 percent of renter households were cost-burdened compared to about 26 percent in 2015. For homeowners, the number of cost-burdened households has remained largely unchanged (1,352 in 2015 and 1,354 in 2019). But as new homeowners come into the county, the share of cost-burdened homeowners has declined from 22 to 20 percent. 

```{r}
#| label: fig-cb
#| fig-cap: !expr "paste0(name, \": Cost-burdened households by tenure\")"

cb <- read_rds("data/cb_7.rds") |> 
  filter(county == name) |> 
  group_by(year, tenure, cb_group) |> 
  summarise(estimate = sum(estimate)) |> 
  mutate(pct = estimate/sum(estimate))

cb_plot <- ggplot(cb,
       aes(x = year, 
           y = pct, 
           fill = cb_group,
           data_id = pct,
           tooltip = percent_format(accuracy = 1)(pct))) +
  facet_wrap(~tenure) +
  geom_col(position = position_fill(reverse = TRUE)) + 
  theme_pha() +
  scale_fill_manual(values = c("#f39152", "#a6cccc", "#e2e4e3")) +
  geom_col_interactive(position = position_fill(reverse = TRUE), size = 2) +
  scale_y_continuous(labels = percent_format()) +
  labs(title = paste0(name, ": Share of cost-burdened households by tenure"),
       subtitle = "2015 to 2018",
       fill = "Cost burden",
       caption = "**Source:** U.S Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(legend.position = "top")


if (knitr::is_html_output()) {
  
  girafe(ggobj = cb_plot,
         height_svg = 4) 
  
} else {
  
  cb_plot
  
  }

```

Available data from William and Mary's Project HOPE shows that the number of enrolled students experiencing homelessness in the county has declined in recent years. The county's McKinney-Vento Act data showed that there were 37 students experiencing homeless in the 2016-2017 school year. By the 2019-2020, that number had declined to 26. 
```{r}
#| label: fig-mkv
#| fig-cap: !expr "paste0(name, \"Enrolled students experiencing homelessness by school year\")"

div <- 63

mkv <- read_csv("data/mkv.csv") |> 
  subset(Division %in% div)

mkv_plot <- ggplot(mkv,
       aes(x = year,
           y = students,
           fill = students,
           data_id = students, 
           tooltip = students)) +
  geom_col() + 
  geom_col_interactive(size = 2) +
  theme_pha() + 
  facet_wrap(~Name) + 
  scale_fill_gradientn(colours = c("#CAE3C2", "#74BA91", "#519B8D", "#2B4258")) +
  labs(title = "Enrolled students experiencing homelessness by school year",
       subtitle = "2016-2017 to 2019-2020",
       caption = "**Source:** William & Mary School of Education, Project HOME - Virginia.")

if (knitr::is_html_output()) {
  
  girafe(ggobj = mkv_plot,
         height_svg = 4) 
  
} else {
  
  mkv_plot
  
  }

```
