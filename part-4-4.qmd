# Hanover County {#part-4-4}

This chapter is a summary of the major changes to the Hanover County's population and housing market in the past five years.

```{r setup}

library(tidyverse)
library(sf)
library(sp)
library(plotly)
library(simplevis)
library(tidytext)
library(scales)
library(readxl)
library(zoo)
library(lubridate)
library(viridis)
library(janitor)

years <- 2016:2020
fips <- 51085
name <- "Hanover County"
costar_name <- "Hanover County"
tenure <- c("Homeowner", "Renter")
tenure_colors <-setNames(viridis(2), nm = tenure)


```

## Takeaways

- More and more people are moving into Hanover County from other parts of the region, state, or nation (+1,747), while deaths are outpacing births (-271) from 2020 to 2021.
- Hanover County is losing households with children --- both homeowners and renters (-725 between 2016 and 2020).
- There has been a net decrease in households making less than \$100,000 --- especially among renters (-950) --- suggesting growing unaffordability in the county.
- Median home price in the county has increased to well over \$400,000 --- becoming one of the most expensive localities in the region.
- Rents in the county rose steeply amid the pandemic and record low vacancy rates.
- A household needs to earn nearly \$70,000 to afford the median home price in the county in 2020 --- roughly \$17,000 more than what the typical renter earns.


## Demographic and socioeconomic changes

### Population changes

Between 2011 and 2012, Hanover County passed the 100,000 mark and has continued to grow ever since. From 2010 to 2020, the county has grown by 10 percent --- an increase of 10,116 residents. 

```{r}
#| label: fig-pop
#| fig-cap: !expr "paste0(name, ": Total Population")"

# Add choice of population stat (net change, components, etc)

pop <- read_rds("data/rr_pop_data.rds") |> 
  mutate(GEOID = parse_number(GEOID)) |> 
  filter(counttype != "Forecast",
         GEOID == fips)

pop_bar <- ggplot(pop,
                      aes(x = year,
                          y = value,
                          fill = value)) +
  geom_col() +
  scale_fill_continuous(viridis_pal()) +
  labs(title = paste0(name, ": Total Population"),
       subtitle = "2010 to 2020",
       caption = "Source: U.S. Census Bureau Decennial Census and American Community Survey.") +
  scale_y_continuous(labels = label_comma()) +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

# ggplotly(pop_bar) |> 
#   plotly_camera()

# 2010 to 2020 increase of 10,116
# 2019 TO 2020 increase of 2,213 -- 2 percent increase

pop_bar

```

The overwhelming reason for population increases in the last several years has been due to domestic migration. From 2020 to 2021, 1,747 new residents moved into Hanover County from some other part of the region, state, or country. From 2016 to 2019, international migration and natural increases made up a small portion of change compared to domestic migration. But during the 2020 to 2021 period, Hanover County experienced a loss of 271 due to natural decreases (i.e. deaths outpacing births in the county). 

```{r}
#| label: fig-comp
#| fig-cap: !expr "paste0(name,": Components of population change")"

change <- read_rds("data/rr_comp_change.rds") |> 
  filter(year %in% as.character(years) | year == "2021") |> 
  filter(NAMELSAD == name)

ggplot(change,
       aes(x = year,
           y = value,
           fill = component)) +
  geom_col() +
  facet_wrap(~component) +
  labs(title = paste0(name,": Components of population change"), 
       subtitle = "2016 through 2021",
       fill = "Component of change",
       caption = "Note: 2020 components of change data not available.\nSource: U.S. Census Bureau, Population Estimates Program.") +
  theme(axis.title = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_y_continuous(labels = label_number(big.mark = ",", style_positive = "plus", style_negative = "minus"))

```

### Household characteristics

Households with children, both homeowners and renters, have been on the decline in Hanover County. Between 2016 and 2020, there was an overall decrease of 725 households with children. Nonfamily renter households also saw a decline (-226), but nonfamily homeowner households saw the greatest increase of household types during this time period (+1,278).

```{r}
#| label: fig-children
#| fig-cap: paste0(name, ": Change in households with children by tenure")

# Add choice of household stat (HHs with children, HHs with seniors, subfamilies, etc)

b25115 <- read_rds("data/b25115_data.rds") |> 
  filter(NAME == name)

ggplot(b25115,
       aes(x = children, y = change, fill = tenure)) +
  geom_col(position = "dodge") + 
  facet_wrap(~children, nrow = 1, scales = "free_x") +
  scale_y_continuous(labels = label_number(style_positive = "plus", big.mark = ",")) +
  labs(title = paste0(name, ": Change in households with children by tenure"),
       subtitle = "2016 to 2020",
       fill = "Tenure",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25115.") +
  theme(axis.title = element_blank(),
        axis.text.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank())

```
As with most of the region, the senior population in Hanover County has seen major growth. From 2016 to 2020, the senior population increased by 3,154. Most of this growth has been among seniors living with a spouse (+1,167), followed by seniors living alone (+888).

```{r}
#| label: fig-seniors
#| fig-cap: !expr "paste0(name, ": Change in senior population by living arrangement")"

b09020 <- read_rds("data/b09020_data.rds") |> 
  filter(NAME == name) |> 
  mutate(family = str_replace(family, "Group quarters", " "),
         family = fct_relevel(family, "Family", "Nonfamily", " "))

ggplot(b09020,
       aes(y = reorder_within(relationship, change, family),
           x = change,
           fill = relationship)) +
  geom_col(position = "dodge") +
  scale_y_reordered() +
  scale_x_continuous(labels = label_comma()) +
  facet_grid(rows = vars(family), scales = "free_y", space = "free", switch = "y") +
  #scale_y_discrete(labels = function(x) str_wrap(x, width = 10)) +
  labs(title = paste0(name, ": Change in senior population by living arrangement"),
       subtitle="2016 to 2020",
       fill="Tenure",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B09020.") +
  theme(axis.title = element_blank(),
        #axis.text.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.position = "none",
        panel.grid.major.x = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank(),
        strip.placement = "outside",
        strip.text.y = element_text(angle = 0))

# sum(b09020$change)

```

### Income and wages

In Hanover County, there was a \$45,460 difference between median homeowner household income and renter household income. The disparity in income has remained steady between 2016 and 2020. But in the county, renter median household income has increased by 19 percent from 2016 to 2020, while homeowners income has only increased by 2 percent. 

```{r}
#| label: fig-income
#| fig-cap: !expr "paste0(name, ": Median houshold income by tenure")"

# Add choice of income stat (probably median household income of some kind)

b25119_cpi <-read_rds("data/b25119_cpi.rds") |> 
  filter(NAME == name)

ggplot(b25119_cpi, 
       aes(x = year,
           y = dollars20,
           fill = tenure)) +
  geom_col() +
  facet_wrap(~tenure) +
  scale_y_continuous(labels = dollar_format(), limits = c(0, NA)) +
  labs(title = paste0(name, ": Median houshold income by tenure"), 
       color = "Tenure",
       subtitle = "2016 to 2020 | Adjusted to 2020 dollars",
       caption = "Source: U.S. Census Bureau, American Community Survey") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "none")

# 19 percent increase for renters
# 2 percent increase for homeowners

```
The growth in median renter household income in the county can be shown to be due to a large decrease in renter households making less than \$75,000 and an increase in renters with higher incomes. 

```{r}
#| label: fig-income-change
#| fig-cap: !expr "paste0(name, ": Change households by tenure and income level")"

b25118_data <-read_rds("data/b25118_data.rds") |> 
  filter(NAME %in% "Hanover County") |>
  group_by(tenure, income) |> 
  summarise(`2016` = sum(`2016`),
            `2020` = sum(`2020`)) |> 
  mutate(change = `2020`-`2016`,
         pct_change = change/`2016`)

ggplot(b25118_data, 
       aes(y = income,
           x = change,
           fill = tenure)) +
  geom_col(position = "dodge") +
  facet_grid(~tenure) +
  scale_x_continuous(labels = label_comma()) +
  scale_y_discrete(limits = c("Less than $15,000","$15,000 to $24,999",
                              "$25,000 to $49,999", "$50,000 to $74,999",
                              "$75,000 to $99,999", "$100,000 to $149,999",
                              "$150,000 or more"),
                   labels = function(x) str_wrap(x, width = 12)) +
  labs(title = paste0(name, ": Change households by tenure and income level"),
       subtitle="2016 to 2020",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25118.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.position = "none",
        panel.grid.major.x = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank()) +
  scale_fill_manual(values = tenure_colors)

```

### Persons with disabilities

While other localities have seen significant increases in adults below 65 years old with independent living difficulties, Hanover County has seen the greatest growth among those aged 75 years and older. With a growing number of aging seniors unable to live with comfortably without assistance, there will be a growing need for assisted living facilities and resources to support aging-in-place.

```{r}
#| label: fig-ind-living
#| fig-cap: !expr "paste0(name, ": Net change in individuals with independent living difficulties by age")"

# Add disability stat (probably independent living difficulty)

b18107 <- read_rds("data/b18107_data.rds") |> 
  filter(NAME == name) |> 
  group_by(age) |> 
  summarise(change = sum(change))

ggplot(b18107,
       aes(x = age,
           y = change,
           fill = age)) +
  geom_col() +
  labs(title=paste0(name, ": Net change in individuals with\nindependent living difficulties by age"),
       subtitle="2016 to 2020",
       caption="Source: U.S. Census Bureau, American Community Survey, Table B18107.") +
  scale_y_continuous(labels = label_comma()) +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```

## Housing supply and market changes

### Homeownership

During the early part of 2022, median home price in Hanover County passed into the \$400,000s. From March 2020 to June 2022, there has been a 32 percent increase in the median home price for the county. 

```{r}
#| label: fig-sales
#| fig-cap: !expr "paste0(name, ": Median home sales price")"

# Median sales price over time

price <- read_csv("data/hanover_med_sales.csv") |> 
  clean_names() |> 
  mutate(geography = name) |> 
  pivot_longer(cols = starts_with("sale"),
    names_to = "label",
    values_to = "med_price",
    values_drop_na = TRUE) |> 
  mutate(year = substr(label, 19,23)) |> 
  select(geography, year, month, med_price)

price$month <- match(price$month, month.abb)

price <- price |> 
  mutate(date = make_date(year, month)) |> 
  mutate(med_price = parse_number(med_price))

ggplot(price,
       aes(x = date,
           y = med_price,
           color = med_price)) +
  geom_line(stat = "identity", size = 1) +
  scale_y_continuous(labels = label_dollar(), limits = c(0, NA)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = paste0(name, ": Median home sales price"),
       subtitle = "January 2017 to June 2022",
       caption = "Source: Central Virginia Regional Multiple Listing Service.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_color_continuous(type = "viridis", label = dollar_format())


```

### Rental

Rental properties across Hanover County are largely located in the Town of Ashland and along the Hanover-Henrico border near Route 1 and Mechanicsville. The Hanover County rental market has been seen continual average asking rent increases since 2016. From the end of Q3 2021 to Q3 2022, rents in Hanover County grew significantly from \$1,272 to \$1,492 --- a 17 percent increase. During this time, the Hanover County rental vacancy rate dropped well-below 1 percent.

```{r}
#| label: fig-rent-submarket
#| fig-cap: !expr "paste0(name, ": Average asking rent by submarket")"

# Average asking rent over time (by submarket if applicable, maybe by bedroom if no submarkets)

# Disaggregate by Richmond CoStar Submarket

# CoStar Filters: Construction Status - Existing

# Added locality field manually

sub_rent <- read_csv("data/rr_submarket_data.csv") |> 
  clean_names() |> 
  separate(geography, into = c("region", "state", "submarket"), sep = " - ") |> 
  select(period, locality, submarket, "rent" = market_asking_rent_unit, vacancy_rate) |> 
  mutate(rent = parse_number(rent)) |> 
  mutate(period = as.Date(as.yearqtr(period, format = "%Y Q%q"), frac = 1)) |> 
  filter(locality == costar_name) |> 
  mutate(year = year(period)) |> 
  filter(year >= 2016)

# Issue with above is that rents are not inflation-adjusted. May need to revisit. I've requested from CoStar to allow for an inflation-adjusted average rent per unit pull, BUT who knows if they can add it. Might consider just having a table with most recent rents.

ggplot(sub_rent,
       aes(x = period,
           y = rent, 
           color = submarket)) +
  geom_line(stat = "identity") + 
  labs(title = paste0(name, ": Average asking rent"),
       subtitle = "2016 Q1 to 2022 Q3 | Not adjusted for inflation",
       color = "Submarket") +
  scale_y_continuous(labels = label_dollar()) +
  scale_x_date(date_labels = "%Y", date_breaks = "2 years", limits = as.Date(c("2016-01-01", "2022-09-30"))) +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "none")

```


```{r}
#| label: fig-vacancy
#| fig-cap: !expr "paste0(name, ": Rental vacancy rate")"


vacancy <- sub_rent  |> 
  select(period, vacancy_rate) |> 
  mutate(vacancy_rate = parse_number(vacancy_rate)) |> 
  mutate(vacancy_rate = vacancy_rate/100)

ggplot(vacancy,
       aes(x = period,
           y = vacancy_rate)) +
  geom_col(fill = "red") + 
  scale_y_continuous(labels = percent_format()) +
  scale_x_date(date_labels = "%Y", date_breaks = "2 years", limits = as.Date(c("2016-01-01", "2022-09-30"))) +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  labs(title = paste0(name, ": Rental vacancy rate"),
       subtitle = "2016 Q1 to 2022 Q3",
       caption = "Source: CoStar Group, Inc.")




```

### Housing assistance

```
Change in number of assisted units (NHPD)
```

### Naturally-occurring affordable housing

As defined by this report, there are only five NOAH multifamily properties located in Hanover County. Across these five properties there is a total of 492 rental units. NOAH properties in Hanover County were built between 1966 and 1987.

```{r}
#| label: fig-noah
#| fig-cap: !expr "paste0(name, ": Distribution of average asking rents in NOAH properties by year built")"

# Add choice of NOAH stat (total number, change in rent, etc) 

noah <- read_csv("data/pha_noah_81722.csv") |> 
  clean_names() |> 
  st_as_sf(coords = c("longitude", "latitude"), crs=4326, remove=FALSE) |> 
  filter(property_name != "Sedgefield") |> 
  filter(county_name == "Hanover") |> 
  mutate(period_built = case_when(
    year_built < 1940 ~ "Before 1940",
    year_built %in% 1940:1959 ~ "1940 to 1959",
    year_built %in% 1960:1969 ~ "1960 to 1969",
    year_built > 1969 ~ "1970 or after"
  )) |> 
  mutate(period_built = fct_relevel(period_built, "Before 1940"))
  

noah_tbl <- noah |> 
  select(property_name, year_built, number_of_units) |> 
  st_drop_geometry() |> 
  kable(caption = "NOAH properties in Hanover County",
        col.names = c("Property name", "Year built", "Estimated units")) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "striped", "hover"))

noah_tbl

# sum(noah$number_of_units)

```

This estimate does not include four manufactured home communities located in the county --- which include a total of 497 homes. Based on the Manufactured Home Community Coalition of Virginia's assessment of manufactured home communities in Central Virginia, these four communities are relatively stable. 

```{r}
#| label: tbl-mhccv
#| tbl-cap: "Manufactured home communities in Hanover County"

library(kableExtra)
library(formattable)

mhc <- read_csv("data/mhccv_data.csv") |> 
  filter(County == "Hanover") |> 
  select(`Park Name`, Units) |> 
  arrange(desc(Units))

mhc |> 
  kable(caption = "Manufactured Home Communities in Hanover County",
        col.names = c("Community name", "Estimated units")) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "striped", "hover"))

sum(mhc$Units)


```
## Gap analysis

### Affordability of current housing stock

In 2020, median renter household income was \$53,832. A household at this income would need an estimated rent of \$1,345 to not be cost-burdened. In comparison to average asking rent in the county, the typical renter could afford the the average rent by more than \$200. This could be a reflection of the growing number of higher income renters coming into the county as previously noted.

```{r}
#| label: fig-income-rent-gap
#| fig-cap: !expr "paste0(name, ": Average asking rent versus rent affordable to median renter income")"

# Compare local median renter income to average asking rent

b25119_cpi_rent <- b25119_cpi |> 
  filter(tenure == "Renter")

rent <- read_csv("data/rr_annual_rent.csv") |> 
    pivot_longer(cols = 2:8,
               names_to = "locality",
               values_to = "rent_current") |> 
  clean_names() |> 
  filter(locality == costar_name)

rent_gap <- b25119_cpi_rent |> 
  left_join(rent, by = "year") |> 
  mutate(rent_current = parse_number(rent_current)) |> 
  mutate(affordable_rent = (cdollars/12)*.30) |> 
  mutate(difference = rent_current - affordable_rent) |> 
  select(year, rent_current, affordable_rent) |> 
  pivot_longer(2:3,
               names_to = "type",
               values_to = "dollars") |> 
  mutate(type = case_when(
    type == "affordable_rent" ~ "Affordable rent",
    type == "rent_current" ~ "Current rent"
  ))

ggplot(rent_gap,
       aes(x = year,
           y = dollars,
           fill = type)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_y_continuous(labels = label_dollar()) +
  labs(title = paste0(name, ": Average asking rent versus\nrent affordable to median renter income"),
       subtitle = "2016 to 2020",
       fill = "Nominal rent",
       caption = "Sources: U.S. Census Bureau, American Community Survey, Table B25119\nand CoStar Group Inc.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))


```
Although median renter income has increased, the gap between income needed to afford the median home sales price has remained. In 2020, there was a \$15,370 difference between a renter median income and the income needed to afford the median home price of \$330,950. Even though this gap remains large, it has narrowed from the 2016 gap when it was \$17,897.

```{r}
#| label: fig-income-own-gap
#| fig-cap: !expr "paste0(name, ": Income needed to afford median home price versus median renter income")"

# Compare local renter income versus local home prices

rr_sales_annual <- read_csv("data/rr_annual_sales.csv") |> 
  pivot_longer(cols = 2:9,
               names_to = "locality",
               values_to = "price") |> 
  clean_names() |> 
  filter(locality == costar_name)

int_annual <- read_csv("data/fredmac_int_annual.csv")

downpayment <- 0.05 # 5% downpayment
closingcosts <- 0.015 # 1.5% closing costs
utilities <- 250 # Assume $250/month for utilities

sale <- rr_sales_annual |> 
  left_join(b25119_cpi_rent, by = "year") |> 
  left_join(int_annual, by = "year") |> 
  drop_na() |> 
  mutate(principal = price - (price*downpayment)) |> 
  mutate(loanamt = principal/(1-closingcosts)) |> 
  mutate(mortgage = abs(PMT((annual_int/12), 360, loanamt)) + 250) |> 
  mutate(inc_needed = ((mortgage*10)/2.8)*12) |> 
  select(year, inc_needed, cdollars)

slgap <- sale |> 
  pivot_longer(2:3,
               names_to = "data",
               values_to = "value") |> 
  mutate(data = case_when(
    data == "cdollars" ~ "Renter median household income",
    data == "inc_needed" ~ "Income needed to afford median home price"
  ))

ggplot(slgap,
       aes(x = year,
           y = value,
           fill = str_wrap(data, 25))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_y_continuous(labels = label_dollar()) +
  labs(title = paste0(name, ": Income needed to afford median home price\nversus median renter income"),
       subtitle = "2016 to 2020",
       fill = "Nominal income",
       caption = "Sources: U.S. Census Bureau, American Community Survey, Table B25119\nand Central Virginia Regional Multiple Listing Service.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.key.height=unit(1, "cm"))


```
In spite of growing income among renters in the county, there was a shortage of 1,705 rental units for households making less than 80 percent AMI. This is a decrease from 2015 when the shortage was 1,840, but still represents a significant number of Hanover renters living in housing that is too expensive for them.

The deficit has decreased across all income levels below 80 percent AMI, but the below 30 percent AMI income group remains the most in need of new affordable rental options.

```{r}
#| label: fig-gap
#| fig-cap: !expr "paste0(name, ": Rental housing gap by AMI")"

# Add choice of affordability stat (surplus/deficit, income vs prices, etc)

gap <- read_rds("data/tb_18_match.rds") |> 
  filter(county == name) |> 
  group_by(year, household_income, gapcode) |>
  summarise(estimate = sum(estimate)) |>
  mutate(estimate = case_when(
    gapcode == "Gap" ~ estimate * -1,
    gapcode == "Matches or less than income" ~ estimate
  )) |>
  mutate(gapcode = case_when(
    gapcode == "Gap" ~ "Shortage of units",
    gapcode == "Matches or less than income" ~ "Households at or less than income"
  )) |>
  filter(household_income != "80 percent AMI or greater")

ggplot(gap,
       aes(x = year, 
           y = estimate,
           fill = gapcode)) +
  geom_bar(stat = "identity") +
  facet_grid(~household_income) +
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0(name, ": Rental housing gap by AMI"),
       subtitle = "2015 to 2018",
       caption = "Source: U.S. Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "bottom",
        legend.title = element_blank())

```

### Impact of housing costs

In spite of the continuous increase in housing costs in Hanover County, there has been an overall decreaes in the number of cost-burdened households from 2015 to 2018. As of 2018, there were 1,061 fewer cost-burdened homeowners and 325 fewer cost-burdened renters.

```{r}
#| label: fig-cb
#| fig-cap: paste0(name, ": Cumulative change in cost-burdened households by tenure")

cb <- read_rds("data/cb_7.rds") |> 
  filter(county == name,
         cb_group == "Cost-burdened") |> 
  group_by(year, county, tenure) |> 
  summarise(estimate = sum(estimate)) |> 
  group_by(county, tenure) |> 
  mutate(change = estimate - lag(estimate)) |> 
  drop_na() |> 
  mutate(run_diff = cumsum(change))

ggplot(cb,
       aes(x = year, y = run_diff, fill = tenure)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0(name, ": Cumulative change in cost-burdened households by tenure"),
       subtitle = "2015 to 2018",
       fill = "Tenure",
       caption = "Source: U.S Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_fill_manual(values = tenure_colors)

```
With fewer renters in the county, there have also been fewer eviction filings and judgements preceding the pandemic. Before the pandemic, Hanover County barely saw more than 75 eviction filings in a given month. 

During eviction protections of the pandemic, filings dropped below 20 a month, while eviction judgements dropped below 10. As new data is released, Hanover County should watch carefully for sudden increases. 

```{r}
#| label: fig-evictions
#| fig-cap: !expr "paste0(name, ": Evictions filings and judgements")"

evictions <- read_csv("data/evictions_17_22.csv") |> 
  pivot_longer(3:128,
               names_to = "data",
               values_to = "value") |> 
  mutate(type = case_when(
    str_detect(data, "Filings") ~ "Filings",
    str_detect(data,"Evictions") ~ "Eviction judgements"
  )) |> 
  mutate(date = str_sub(data, -7, -1)) |> 
  mutate(date = ym(date)) |> 
  mutate(year = year(date)) |> 
  mutate(type = fct_relevel(type, "Filings", "Eviction judgements")) |> 
  filter(Jurisdiction == "Hanover")

eviction_colors <- setNames(c("#00BFC4", "#F8766D"),
                            nm = c("Filings", "Eviction judgements"))

ggplot(evictions,
       aes(x = date,
           y = value,
           fill = type)) +
  geom_col(position = "dodge") +
  scale_x_date(labels = label_date_short(), breaks = breaks_width("6 months")) +
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0(name, ": Evictions filings and judgements"),
       subtitle = "January 2017 to March 2022",
       caption = "Source: RVA Eviction Lab") +
  scale_fill_manual(values = eviction_colors) +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        axis.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank())

```