---
format:
  revealjs:
    incremental: true
    self-contained: true
    theme: simple
    height: 900
    width: 1400
    slide-number: true
title: "Richmond Regional Housing Framework Data Update"
subtitle: "Selected draft findings"
author: "HDAdvisors"
date: 2022-09-08
---

## Research scope

```{r}
#| label: setup
#| include: false

library(tidyverse)
library(scales)
library(janitor)
library(zoo)
library(viridis)
library(lubridate)
library(tidytext)

pha_names <- c("Richmond city", "Hanover County", "Henrico County", "Chesterfield County")

pha <- c("51085", "51760", "51087", "51041")

geo_colors <- setNames(viridis(4), nm = pha_names)
tenure <- c("Homeowner", "Renter")
tenure_colors <-setNames(viridis(2), nm = tenure)

```



*How have housing needs changed across the region since the original Framework release?*

. . .

Four parts:

1.  Demographic and socioeconomic changes
2.  Housing supply and market changes
3.  Gap analysis
4.  Local summaries

## Data source updates

| Source                                       | Original                   | Current                               |
|-----------------------------|------------------|-------------------------|
| American Community Survey                    | 2013-2017 5-year estimates | 2016-2020 5-year estimates            |
| Comprehensive Housing Affordability Strategy | 2012-2016 5-year estimates | 2014-2018 5-year estimates            |
| Census Population Estimates Program          | 2018                       | 2021, including 2020 Decennial Census |
| Census Building Permits Survey               | 2018                       | 2022, through July                    |
| MLS                                          | 2019                       | 2022, through August                  |
| CoStar                                       | *Not used*                 | 2022, through August                  |

## Other updated datasets

Additional sources used for this refresh include:

-   National Housing Preservation Database
-   BLS Occupational Employment and Wage Statistics
-   CFPB Mortgage Performance Trends
-   Point-in-Time homelessness counts and McKinney-Vento student homelessness statistics
-   District court eviction filings and judgments

# Demographic and socioeconomic changes

## More people come here than are born here.

<br>

```{r}
#| label: components-plot
#| echo: false

pha_comp_change <- read_rds("../data/rr_comp_change.rds") |> 
  filter(NAMELSAD %in% pha_names)

comp_chg_summary <- pha_comp_change |> 
  group_by(year, component) |> 
  summarise(value = sum(value)) |> 
  mutate(year = as.numeric(year),
         percent = value/sum(value)) |> 
  filter(year >= 2016 & year != 2020) |> 
  mutate(year = as.character(year))

ggplot(comp_chg_summary,
       aes(x=year,
           y=percent,
           fill=component)) + 
  geom_bar(stat="identity", position = "stack") +
  labs(title="Components of population change",
       subtitle = "Share of regional population growth by source",
       caption = "Note: Data not available for 2020.\nSource: U.S. Census Bureau, Population Estimates Program.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        legend.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05)) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = viridis(3))

```


## Young adults are shacking up.

<br>

```{r}
#| label: hh-adultchild-plot
#| echo: false

b09021_data <- read_rds("../data/b09021_data.rds") |> 
  filter(NAME %in% pha_names) |>
  group_by(arrangement) |> 
  summarise(`2016` = sum(`2016`),
            `2020` = sum(`2020`)) |> 
  mutate(pct_change = (`2020`-`2016`)/`2016`)

ggplot(b09021_data,
       aes(x = reorder(arrangement, pct_change),
           y = pct_change,
           fill = arrangement,
           color = arrangement,
           label = label_percent()(pct_change))) +
  geom_col(position = "dodge") +
  geom_text(aes(y = pct_change + sign(pct_change)/75,
                label = label_percent(accuracy = 0.1)(pct_change)),
            size = 4) +
  scale_y_continuous(labels = label_percent(),
                     breaks = c(-0.075,-0.05, -0.025, 0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15, 0.175),
                     limits = c(-0.08,0.18)) + 
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  labs(title = "Change in 18-34 year old population by living arrangement",
       subtitle="2016 to 2020",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B09021.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank())

```

## Lowest-payed workers saw the biggest (relative) pay bumps.

```{r}
#| label: wage-pct-plot
#| echo: false

oews_pct <- read_rds("../data/oews_pct.rds")

ggplot(oews_pct,
       aes(x = pct_change,
           y = wage,
           fill = wage)) +
  geom_col() +
  geom_text(aes(label = label_percent(accuracy = 0.1)(pct_change),
                color = wage),
            nudge_x = 0.01) +
  labs(title = "Percent change in annual wage by wage percentile",
       subtitle = "Richmond, VA MSA | May 2019 to May 2021",
       caption = "Source: U.S. Bureau of Labor Statistics, Occupational Employment and Wage Statistics.") +
  scale_x_continuous(labels = label_percent()) +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.position = "none",
        panel.grid.major.x = element_line(color = "grey95",
                                          size = 0.05))

```

# Housing supply and market changes

## Racial homeownership gaps remain the status quo.

<br>

```{r}
#| label: ho-race-plot
#| echo: false

b25003_race_data <- read_rds("../data/b25003_race_data.rds") |> 
  filter(locality %in% pha_names) |> 
  group_by(year, tenure, race) |> 
  summarise(estimate = sum(estimate)) |> 
  group_by(year, race) |> 
  mutate(pct = estimate/sum(estimate)) |> 
  filter(tenure == "Homeowner")

ggplot(b25003_race_data,
       aes(x = year, 
           y = pct, 
           color = race)) +
  facet_wrap(~fct_reorder(race, pct, .fun = median, .desc = TRUE),
             labeller = label_wrap_gen(10),
             nrow = 1) +
  geom_line(stat = "identity", size = 1) + 
  scale_y_continuous(labels = label_percent(), limits = c(0.05, 0.85), n.breaks = 8) +
  labs(title = "Homeownership rate by race and ethnicity",
       subtitle = "2016 to 2020",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25003.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none",
        legend.title = element_blank(),
        legend.key = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.text.x = element_text(angle = 90, vjust = 0.5),
        axis.line.x = element_line(color = "grey50",
                                   size = 0.1))

```

## A tight supply is pushing existing home prices closer to new build prices.

```{r}
#| label: comp-price-plot
#| echo: false

pha_price_comp <-  read_rds("../data/pha_price_comp.rds")

ggplot(pha_price_comp,
       aes(x = date, y = med_price, color = type)) +
  geom_line(size = 1) +
  scale_y_continuous(labels = label_dollar()) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  labs(title = "Median price of new construction and resale",
       subtitle = "January 2017 to June 2022",
       caption = "Source: Central Virginia Regional Multiple Listing Service.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        legend.position = "bottom",
        legend.key = element_blank(),
        legend.title = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```

## The supply of 2- and 3-bedroom apartments *decreased*.

<br>

```{r}
#| label: ro-bedrooms
#| echo: false

b25042_data <- read_rds("../data/b25042_data.rds") |> 
  filter(GEOID %in% pha,
         tenure == "Renter") |> 
  group_by(br) |> 
  summarise(change = sum(change))

ggplot(b25042_data,
       aes(x = br,
           y = change,
           fill = br)) +
  geom_col() + 
  labs(title = "Change in renter-occupied housing units by number of bedrooms",
       subtitle = "2016 to 2020",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25042.") +
  theme(panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none") +
  scale_y_continuous(labels = label_comma()) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 16))

```

## Rising prices for 2- and 3-bedroom apartments reflect higher demand.

<br>

```{r}
#| label: avg-rent-br
#| echo: false

# Aggregated average market asking rent per unit for Chesterfield, Hanover, Henrico, and Richmond City.

# CoStar Filters: Construction Status - Existing

# As of mid-JULY; inflation-adjusted

pha_rent_br <- read_csv("../data/pha_rent_br.csv") |> 
  clean_names() |> 
  mutate(period = case_when(
    period == "2022 Q3 QTD" ~ "2022 Q3",
    TRUE ~ period)) |> 
  mutate(period = as.Date(as.yearqtr(period, format = "%Y Q%q"), frac = 1)) |>
  pivot_longer(cols = 2:5,
               names_to = "br",
               values_to = "rent") |> 
  mutate(br = case_when(
    br == "studio" ~ "Studio",
    br == "x1_bed" ~ "One bedroom",
    br == "x2_beds" ~ "Two bedrooms",
    br == "x3_beds" ~ "Three bedrooms")) |> 
  mutate(rent = parse_number(rent),
         br = fct_reorder(br, rent, .desc = TRUE)) |> 
  filter(between(period, as.Date("2010-03-31"), as.Date("2022-06-30"))) |> 
  mutate(period = as.yearqtr(period))
  
ggplot(pha_rent_br,
       aes(x = period, y = rent, color = br)) +
  geom_line(size = 1) +
  scale_y_continuous(labels = label_dollar(),
                     n.breaks = 9) +
  scale_x_yearqtr(format = "%Y Q%q") +
  labs(title = "Average asking rent by bedroom",
       subtitle = "2019 Q1 to 2022 Q2 (inflation-adjusted)",
       caption = "Source: CoStar Group, Inc.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```

## Our supply of dedicated affordable rentals increased by 2,700.

<br>

```{r}
#| label: subsidized-change
#| echo: false

nhpd_clean_rr <- read_rds("../data/nhpd_clean_rr.rds")

change <- nhpd_clean_rr |> 
  mutate(change_type = case_when(
    start_date > '2019-12-31' ~ "Added",
    end_date < '2022-09-01' & end_date > '2019-12-31' ~ "Removed",
    TRUE ~ "No change")) |> 
  group_by(subsidy_name, change_type) |> 
  summarise(units = sum(assisted_units)) |> 
  filter(change_type != "No change") |> 
  mutate(units = if_else(change_type == "Removed", units*-1, units)) |> 
  pivot_wider(
    names_from = change_type,
    values_from = units) |> 
  mutate(Added = replace_na(Added, 0),
         `Net change` = Removed + Added) |> 
  pivot_longer(
    cols = 2:4,
    names_to = "change_type",
    values_to = "units") |> 
  mutate(subsidy_name = fct_reorder(subsidy_name, units, .desc = TRUE),
         change_type = fct_relevel(change_type, "Added", "Removed", "Net change"),
         subsidy_name = str_wrap(subsidy_name, width = 10))

ggplot(change,
       aes(x = reorder_within(subsidy_name, units, change_type),
           y = units,
           fill = subsidy_name,
           color = subsidy_name,
           label = label_comma()(units))) +
  geom_col(position = "dodge") +
  geom_text(aes(y = units + sign(units)/0.003)) +
  facet_wrap(~change_type, scales = "free_x") +
  scale_x_reordered() +
  scale_y_continuous(labels = label_comma(),
                     limits = c(-2000, 3500),
                     n.breaks = 10) +
  labs(title = "Additions and removals of subsidized rental unit contracts",
       subtitle = "January 2020 through August 2022",
       caption = "Source: National Housing Preservation Database and Virginia Housing.") +
  theme(legend.position = "none",
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                  size = 0.05))

```


## Rents are skyrocketing in "naturally-occurring" affordable multifamily properties.

<br>

::::: {.columns}

:::: {.column width="75%"}

```{r}
#| label: noah
#| echo: false
#| fig-asp: 0.6

noah_rent <- read_csv("../data/pha_noah_rent_81722.csv") |> 
  mutate(period = as.Date(as.yearqtr(period, format = "%Y Q%q"), frac = 1)) |> 
  pivot_longer(cols = 2:3,
               names_to = "type",
               values_to = "rent") |> 
  mutate(type = case_when(
    type == "inf_adj" ~ "Inflation-adjusted",
    type == "rent" ~ "Nominal"
  )) |> 
  mutate(rent = parse_number(rent)) |> 
  filter(between(period, as.Date("2014-03-31"), as.Date("2022-09-30"))) |> 
  mutate(period = as.yearqtr(period))

ggplot(noah_rent,
       aes(x = period, y = rent, color = type)) +
  geom_line(size = 1) +
  scale_y_continuous(labels = label_dollar(),
                     n.breaks = 9) +
  scale_x_yearqtr(format = "%Y Q%q") +
  labs(title = "Average asking rent for market-affordable multifamily",
       subtitle = "2014 Q1 to 2022 Q3 (to-date)",
       color = "Rent value",
       caption = "Source: CoStar Group, Inc.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05))

```

::::

:::: {.column width="25%"}

::: callout-tip

### Defining NOAH

We use CoStar's definition for naturally-occurring affordable housing (NOAH):
  
Non-subsidized rents, one or two star rating, built before 2000, Class B or C (or unclassified).

:::

::::

:::::

# Gap analysis

## On average, renters in the counties face the largest affordability gaps.

<br>

::::: {.columns}

:::: {.column width="75%"}

```{r}
#| label: costs
#| echo: false
#| fig.asp: 0.6

costs_income_change <- read_rds("../data/costs_income_change.rds")
  
ggplot(costs_income_change,
       aes(x = year,
           y = pct_chg,
           color = type)) +
  geom_line(size = 1) +
  facet_wrap(~locality) +
  scale_y_continuous(labels = label_percent()) +
  labs(title = "Cumulative percent change in median renter income and average rent",
       subtitle="2016 to 2022",
       color = "Percent change",
       caption = "Sources: U.S. Census Bureau, American Community Survey, Table B25119,\nCentral Virginia MLS, and CoStar Group, Inc.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = "right",
        axis.text.x = element_text(angle = 90),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank())

```

::::

:::: {.column width="25%"}

::: callout-warning

### Data limitation

Median renter income data only available through 2020.
  
Data for 1-year 2021 ACS estimates to be released this month; 2017-2021 5-year estimates (more reliable) due early 2023.

:::

::::

:::::

## Rent burdens may be shifting up the income scale.

<br>

```{r}
#| label: cb-income-acs-est
#| echo: false
#| fig-asp: 0.4

b25074_data <- read_rds("../data/b25074_data.rds")

ggplot(b25074_data,
       aes(x = year, y = estimate, fill = cb_group)) +
  geom_col(position = "dodge") +
  facet_wrap(~inc, nrow = 1, labeller = label_wrap_gen(width = 12, multi_line = TRUE)) +
  labs(title = "Renter households by income and cost burden",
       subtitle = "2016 to 2020",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25074.") +
  scale_y_continuous(labels = label_comma()) +
  theme(axis.title = element_blank(),
        axis.text.x = element_text(size = 8, angle = 90, vjust = 0.5),
        legend.position = "bottom",
        legend.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank()) +
  scale_fill_manual(values = c("#d8b365", "#018571", "#80cdc1"))

```

::: callout-warning

### Use with caution

Estimates for 2020 (the 2016-2020 5-year ACS release) may be impacted by lower survey response rates during the COVID-19 pandemic.

:::

# Local summaries

## Richmond City

:::: {.columns .nonincremental}

::: {.column width="70%"}

```{r}
#| label: rva-eviction
#| echo: false
#| fig-asp: 0.75

evictions <- read_csv("../data/evictions_17_22.csv") |> 
  pivot_longer(3:128,
               names_to = "data",
               values_to = "value") |> 
  mutate(type = case_when(
    str_detect(data, "Filings") ~ "Filings",
    str_detect(data,"Evictions") ~ "Eviction judgements"
  )) |> 
  mutate(date = str_sub(data, -7, -1)) |> 
  mutate(date = ym(date)) |> 
  mutate(year = year(date)) |> 
  mutate(type = fct_relevel(type, "Filings", "Eviction judgements")) |> 
  filter(Jurisdiction == "Richmond City")

eviction_colors <- setNames(c("#00BFC4", "#F8766D"),
                            nm = c("Filings", "Eviction judgements"))

ggplot(evictions,
       aes(x = date,
           y = value,
           fill = type)) +
  geom_col(position = "dodge") +
  scale_x_date(labels = label_date_short(), breaks = breaks_width("6 months")) +
  scale_y_continuous(labels = label_comma()) +
  labs(title = "City of Richmond: Evictions filings and judgements",
       subtitle = "January 2017 to March 2022",
       caption = "Source: RVA Eviction Lab") +
  scale_fill_manual(values = eviction_colors) +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        axis.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank())

evictions_post <- evictions |> 
  filter(year >= 2020) |> 
  group_by(year, type) |> 
  summarise(mean = mean(value))

evictions_pre <- evictions |> 
  filter(year < 2020) |> 
  group_by(year, type) |> 
  summarise(mean = mean(value))

```

:::

::: {.column width="30%"}

-   State and federal eviction protections significantly cut down on evictions

-   Average eviction judgements per month in 2022 were 62 --- an 89 percent reduction from the 2019 average of 576

-   Data only through March --- 16,000 eviction hearings scheduled in August statewide

:::

::::

## Chesterfield County

:::: {.columns .nonincremental}

::: {.column width="70%"}

```{r}
#| label: cf-gap
#| echo: false
#| fig-asp: 0.75

gap <- read_rds("../data/tb_18_match.rds") |> 
  filter(county == "Chesterfield County") |> 
  group_by(year, household_income, gapcode) |>
  summarise(estimate = sum(estimate)) |>
  mutate(estimate = case_when(
    gapcode == "Gap" ~ estimate * -1,
    gapcode == "Matches or less than income" ~ estimate
  )) |>
  mutate(gapcode = case_when(
    gapcode == "Gap" ~ "Shortage of units",
    gapcode == "Matches or less than income" ~ "Households at or less than income"
  )) |>
  filter(household_income != "80 percent AMI or greater")
ggplot(gap,
       aes(x = year, 
           y = estimate,
           fill = gapcode)) +
  geom_bar(stat = "identity") +
  facet_grid(~household_income) +
  scale_y_continuous(labels = label_comma()) +
  labs(title = paste0("Chesterfield County rental housing gap by AMI"),
       subtitle = "2015 to 2018",
       caption = "Source: U.S. Department of Housing and Urban Development,\nComprehensive Housing Affordability Strategy (CHAS), Table 7.") +
  theme(axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        legend.position = "bottom",
        legend.title = element_blank())
```

:::

::: {.column width="30%"}

-   In 2018, there was a shortage of 7,569 rental units for households below 80% AMI

-   Greatest need in the county has been among households below 50% AMI

-   But the need for rental at the higher end has been increasing (15% increase)

:::

::::

## Hanover County

:::: {.columns .nonincremental}

::: {.column width="70%"}

```{r}
#| label: hanover-income
#| echo: false
#| fig-asp: 0.75

b25118_data <-read_rds("../data/b25118_data.rds") |> 
  filter(NAME == "Hanover County") |>
  group_by(tenure, income) |> 
  summarise(`2016` = sum(`2016`),
            `2020` = sum(`2020`)) |> 
  mutate(change = `2020`-`2016`,
         pct_change = change/`2016`)

ggplot(b25118_data, 
       aes(y = income,
           x = change,
           fill = tenure)) +
  geom_col(position = "dodge") +
  facet_grid(~tenure) +
  scale_x_continuous(labels = label_comma()) +
  scale_y_discrete(limits = c("Less than $15,000","$15,000 to $24,999",
                              "$25,000 to $49,999", "$50,000 to $74,999",
                              "$75,000 to $99,999", "$100,000 to $149,999",
                              "$150,000 or more"),
                   labels = function(x) str_wrap(x, width = 12)) +
  labs(title = "Hanover County: Change households by tenure and income level",
       subtitle="2016 to 2020",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25118.") +
  theme(axis.title = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.position = "none",
        panel.grid.major.x = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank()) +
  scale_fill_manual(values = tenure_colors)

```

:::

::: {.column width="30%"}

-   Between 2016 and 2020, overall decrease in households making less than $100,000

-   Due to loss of lower income households and increases in household incomes among homeowners **and** renters

-   Home prices following suit --- median home price now over $400,000

:::

::::

## Henrico County

:::: {.columns .nonincremental}

::: {.column width="70%"}

```{r}
#| label: hen-children
#| echo: false
#| fig-asp: 0.75


# Add choice of household stat (HHs with children, HHs with seniors, subfamilies, etc)

b25115 <- read_rds("../data/b25115_data.rds") |> 
  filter(NAME == "Henrico County")

ggplot(b25115,
       aes(x = children, y = change, fill = tenure)) +
  geom_col(position = "dodge") + 
  facet_wrap(~children, nrow = 1, scales = "free_x") +
  scale_y_continuous(labels = label_number(style_positive = "plus", big.mark = ",")) +
  labs(title = "Henrico County: Change in households with children by tenure",
       subtitle = "2016 to 2020",
       fill = "Tenure",
       caption = "Source: U.S. Census Bureau, American Community Survey, Table B25115.") +
  theme(axis.title = element_blank(),
        axis.text.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey95",
                                          size = 0.05),
        axis.ticks = element_blank()) +
  scale_fill_manual(values = tenure_colors)

```

:::

::: {.column width="30%"}

-   In stark contrast to homeowners, renter households are not seeing large increases

-   Most notably, there’s been a decrease in renter households with children by 1,010

:::

::::

## Next steps

-   Share slides and draft report

-   Feedback from PHA Board and staff

-   Complete final updates on report (incorporating edits and suggestions)

-   Consistent branding and visualizations

-   Provide updates to data based on timing

-   Assist PHA with creating additional collateral

# Discussion